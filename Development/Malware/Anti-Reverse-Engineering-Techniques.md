# Anti-Reverse Engineering Techniques


[[Circumvent-Anti-Reverse-Engineering]]


## Anti-Debugging

- Enumerating for debugger present 
	- [[Windows-API]] - [[Useful-Functions-And-Syscalls]]: `IsDebuggerPresent`
- Tampering with debug registers
	- Corrupt debug logs (debugger requires to control execution flow)
- Self-modifying code
- Windows API function [SuspendThread](https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-suspendthread)  is used to pause execution of a thread
	- [THM](https://tryhackme.com/room/antireverseengineering) gave the explain of using `EnumWindow` to then find a GUI window to find strings dbg, debug or debugger

## VM Detection

Detection Techniques
- Check running processes
	- [EnumProcess](https://learn.microsoft.com/en-us/windows/win32/api/psapi/nf-psapi-enumprocesses) Windows API to list all processes
- Checking installed software
	- Search under the [[Windows-Registry]]:
		- `SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall`
		- For debuggers, decompilers, forensics tools, etc
- Network fingerprinting
	- Check for auto- generated MAC addresses:
	- `00-05-69`, `00-0c-29`, `00-1c-14` or `00-50-56` - VM vendor's OUI (Organisationally Unique Identifier)
- Checking machine resources
	- Percentage of RAM and CPU utilisation
- Detecting peripherals
	- Checking for (un|mis)configured printers common to VM 
- Checking for domain membership
	- Checking whether the machine is Domain Joined in Active Directory 
- Timing-based attacks
	- Measuring duration of execution of specific instructions or access particular machine resources
- Checking the Temperature
	- `Win32_TemperatureProbe` is the Windows Management Instrumentation (WMI) class that contains real-time temperature readings from the hardware through the SMBIOS (System Management BIOS) data structure
	- Will return  `Not Supported` if hardware does not support SMBIOS 

Post-VM Detection Action
- Executing only a minimal subset of its functionality
- Self-destructing by deleting itself or overwriting parts of its code 
- Cause damage to the system by deleting or encrypting files; or
- Not run at all






- Use TLS callbacks

## References


[EnumProcess](https://learn.microsoft.com/en-us/windows/win32/api/psapi/nf-psapi-enumprocesses)
[SuspendThread](https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-suspendthread) 
[THM Anti-Reverse Engineering](https://tryhackme.com/room/antireverseengineering) 