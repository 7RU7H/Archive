# Go Malware Writing For Windows


This is a must read: [justen.codes Medium article on Using Go to call Window API](https://justen.codes/breaking-all-the-rules-using-go-to-call-windows-api-2cbfd8c79724) tyhen follow-up with: [AnubisSec use of the justen.Codes article](https://anubissec.github.io/How-To-Call-Windows-APIs-In-Golang/#)

Go compiler OPSEC
```bash
GOOS=windows GOARCH=amd64 go build -ldflags="-s -w -H=windowsgui" -trimpath
```

Compiling on Windows
```powershell
'c:\Program Files\Go\bin\go.exe' build -ldflags="-s -w" -gcflags="all=-trimpath=C:\Path\To\Tools\PotUtils\GoPotUtils" -asmflags="all=-trimpath=C:\Path\To\Tools\PotUtils\GoPotUtils" -o GoPotUtils.exe .\GoPotUtils.go


GOOS=windows GOARCH=amd64 go build -ldflags="-s -w -H=windowsgui" -gcflags=-trimpath=/path/to/SandboxSpy -asmflags=-trimpath=/path/to/SandboxSpy SandboxSpy.go

GOOS=windows GOARCH=386 go build -ldflags="-s -w -H=windowsgui" -gcflags=-trimpath=/path/to/SandboxSpy -asmflags=-trimpath=/path/to/SandboxSpy SandboxSpy.go
```
https://github.com/ZephrFish/SandboxSpy
https://github.com/ZephrFish/PotUtils
[GitHub ZephrFish/SandboxSpy](https://github.com/ZephrFish/SandboxSpy)

#### Libary Considerations


#### Loading DLLs

```go
var (
	// Load a dll 
	targetDLL = windows.LOADFUNC("TARGET.dll")
	// Either function
	LIBRARY.NewLazyDLL() // loads the dll at first function call made from it
	LIBRARY.LoadLibrary() // load dll immediately
)

```

#### Calling Procedures


#### Passing Arguments

Arguments
```go
syscall.Syscall() // : less than 4 arguments
syscall.Syscall6() // : 4 to 6 arguments
syscall.Syscall9() // : 7 to 9 arguments
syscall.Syscall12() // : 10 to 12 arguments
syscall.Syscall15() // : 13 to 15 arguments
```