# Post Exploitation: Striking Gold with Covert Recon - Derek Rook


[Post Exploitation: Striking Gold with Covert Recon - Derek Rook](https://www.youtube.com/watch?v=04H1s9z0JDo)

You're on a covert penetration test focusing on the client's monitoring and alerting capabilities. You've just established a foothold, maybe even elevated to admin, but now what? You want to know more about the internal network but careless packet slinging will get you caught. Join me on a mining expedition where you can't swing your pick axe without striking gold. We'll be mining logs, pilfering connection statistics, and claim jumping process network connections. Without leaving the comfort of your beachhead, you'll be shouting "Eureka!" in no time.

#### Packet Economy

Packet Economy = More Packets == More opportunities to get caught

## Covet Recon

- Have patience - "The quieter you are the more you can listen.."
- We are here to understand what the environment is like to map it and then move thorough it discreetly
- Go low and slow - Blend in and take your time, but be efficient with your time - stealthy throttled automation
	- Script it up, but make it wait or throttle the automation so that it can run in the background.
- Ratchet up the noise once the objectives accomplished to get caught systemically so that implementation of improving monitoring can be actionable 

- Mimic User Behaviour
	- Be active around the same time as user
		- Timing
			- Look at:
				- Understand the current system time
				- Auth Logs
					- Beware people most people do not log off, shutdown and turn off
				- Update Logs
					- Crons, Scheduled task ...or odd time is probably the Administrator
				- App Logs
					- When are people interacting with the server
	- Automated Vs Manual interaction
	- Process Lists and Scheduled Tasks
		- What is currently running
			- Software for what the use that machine for
		- What runs commonly
			- And when?
				- If `net` commands or administrative utilities are not being run on the machine - probably a honeypot 
		- When are "permission" requested to run certain software, command, etc 
	- Network Caches - for Network topology
		- DNS
			- Who are they communicating with
			- Piece together a picture of the network
		- ARP 
			- More pieces of the network
			- Manufacturers, VMs, etc from MAC addresses!
				- VMs have specific MAC addresses
	- Sifting Files for Gold
		- File metadata - Nomenclature for [[Phishing]] later 
			- Computer Names
			- User Names
			- UserIDs
		- Keep the OSINT up after breaching - there are more Office Documents inside! (beware OPSec) - try [[Data-Exfiltration-Defined]] and by the by protocol 
			- FOCA
			- PowerMeta
	- Revisiting Log Files
		- Get credentials
			- Application definitely never log passwords...
			- Password Spray and guess and reuse..
	- User Profiles and Scripts
		- SSH Configs
			- Known hosts
			- SSH Keys
		- Aliases and Command Histories
		- Scripts
			- Hard Coded Credentials
			- Hints about cloud buckets, Metadata endpoints, role permissions
				- Beware API logging of Metadata endpoints!
					- Look if the machine, user are hitting those API from History files
	- Remote File Systems
		- SMB communication "allowed"
		- Enumerate other hosts without leaving your own
		- Pillage mount -a  or `/etc/fstab`
		- `net share` - potential logged
- Use Nmap when it is appropriate, but if users do not have you those tools then you need look at what is on the system in a stealthy way without slinging packets across the network.  
- Knowing multiple way to get the same potential information is very useful
	- Catch the computer in lies! Rootkits are here! 
## References

[Post Exploitation: Striking Gold with Covert Recon - Derek Rook](https://www.youtube.com/watch?v=04H1s9z0JDo)