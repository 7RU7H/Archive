# Sandbox Evasion

## Introduction

Sandboxes allow Malware Analysts to perform Dynamic Analysis that is more representive of the actual execution chain of a piece of malware by creating of safe and containize or virtualisd environment for the malware to operate in to then monitor it. Sandboxs within network meaning that any unsafe or suspicious file run simulatively without causing harm before it is run on a production system. Evasion therefore is imperative for the success of a strain malware as it must preemptively defend against dynamic analysis. 

As with all infinite Malware Dev Vs Analysist esculation of complexity this article will almost certianly become outdated and probably from my limit time to research it is already outdated. The key lesson to take away from any known knowns and general systemic presuppositions about how both parties exist and their objectives is:

**This next statement(s) is just a rough splattering of what I am trying to state here and will be edited to make it less of a ramble or philophical skid mark** - just a note for me and warning to others.
1. Metaness of contexts of how either Dev or Analyst use the knowable finite architecture, code, etc no matter how effective, each party continues to seek and utilise (meta/assumptative)information about the other the evade the other to execute their goals.  

Throughout the article I try to reveal a three step 1. Malware does `X` due to Sandbox have `A` property, Blue team will do `Y` and Malware Dev could then do `Z`. This is just to replicate the esculative effect of adversial relationships with  opposing, but symbiotic objectives. No malware means no  analysis to be done. There will alway be malware therefore there will always be analystist to help defend against it, which means there will always be a esculation of capability.

## Sleeping through Sandboxes

Sandboxes are limited to time constraints to prevent overallocation of network resources. Implementing a sleep timer that waits.

1. Query the system time in a parallel thread.
2. Do compute heavy maths that will take certain amount of time.

**Mitigations** - Sandboxes may alter the system clocks, built-in sleep functions 

**Therefore** - Develop your own unique sleep function code that won't have a signature on.

[evasions.checkpoint.com](https://evasions.checkpoint.com/techniques/timing.html)
[joesecurity](https://www.joesecurity.org/blog/660946897093663167#)

## Geolocation

Sandboxes can be virtualise and therefore be located off-site and hosted by Anti-Virus Providers. If target company is `X` county but Malware is beaconing back from `Y` country, even if company is globally networked it would make little sense to not regionalise Sandboxing to allow more Malware Analysis to occur.

1. Geolocation filter, checks IP address block of target company is the same as located
	1. [ifconfig.me](https://ifconfig.me) - Retrieve current IP
	2. [https://rdap.arin.net/registry/ip/1.1.1.1](https://rdap.arin.net/registry/ip/1.1.1.1) - detirmine the ISP returned in json 

**Mitigations** - No internet for Malware