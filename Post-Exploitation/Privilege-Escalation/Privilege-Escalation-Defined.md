# Privilege Escalution Defined

In the [[Lockhead-Martin-Cyber-Kill-Chain]], after intial [[Foothold-On-AD]] or any other Server or Machine, the next step is the increase the level of access rights on host machine. This process is called Privilege Escalution, two phase process:
1. Gathering information phase 
2. Attempting to move vertically or horizontally with information gather

Repeat the previous to processes till at the highest level of access rights.
Target machines can be consider unique given differences in operating systems, patch level, network connectivy, service operable, etc. [[Linux-Privilege-Escalation]] differs from [[Windows-Privilege-Escalation]] and [[Active-Directory-Privilege-Escalation]] architectural, but the search for misconfigurations, permissive lack of restrictions, vulnerabilities(running or static) in software or kernel space, leaked sensitive information stored in files (log, configuration, emails, etc), databases, registery settings or hardcode credentials, and more!

Enumeration can be done manually or be automated

## Manual Enumeration 

1. Users
2. Hostname
3. OS version and architecture
4. Processes
5. Services
6. Scheduled Tasks
7. Networking Information
8. Firewall status and rules
9. Installed Applications
10. Patch levels
11. Readable/Writable Files and Directories
12. Unmounted Disks
13. Device Drivers
14. Kernel Modules
15. Binaries That AutoElevate

## Automated Enuemration

Script help automate the information gathering process, various are list in [[Linux-Privilege-Escalation]], [[Windows-Privilege-Escalation]] and [[Active-Directory-Privilege-Escalation]]. Some specific script cheat/helpsheets avaliable in [[Contents]] of Archive are:

OS | Script Cheat/Helpsheet
--- | ---
Windows | [[wesng]]


## Concepts Related to Windows Privilege Esculation

#### Permissions and Integrity

[[Windows-Permissions]] reflect the leevel of privilege of a specific account to perform system-related local operations. Use of some [[Windows-CLI-cmd]], [[WMIC-Commands]] and [[Windows-Networking-Commands]] are restricted to some accounts. [[Windows-Accounts-Groups]] have unique [security identifier](https://docs.microsoft.com/en-us/windows/win32/secauthz/security-identifiers) (SID), maintain be Windows Local Secruity Authority that assigned objects(Users, groups can be object[[Object-Oriented-Programing]]) and tokens are given access tokens that describe the security context of a given object.

[[Windows-Processes]] from Vista onwards run on one of four integrity levels, part of the [Windows Integrity Mechanism](https://docs.microsoft.com/en-us/previous-versions/dotnet/articles/bb625957(v=msdn.10)?redirectedfrom=MSDN)

Process | Rights
--- | ---
System integrity process | SYSTEM rights
High integrity process | Administrative rights
Medium integrity process |  Standard user rights
Low integrity process: | Very restricted rights 

#### User Account Control
[User Account Control](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-overview): *"User Account Control (UAC) helps prevent malware from damaging a PC and helps organizations deploy a better-managed desktop. With UAC, apps and tasks always run in the security context of a non-administrator account, unless an administrator specifically authorizes administrator-level access to the system. UAC can block the automatic installation of unauthorized apps and prevent inadvertent changes to system settings."*

UAC has two modes:
1. Credential prompt - Provide credentials
2. Consent prompt - Consent to action

UAC logs activity on the machine to allow for the above and notifying Administrative Account to respond to incidents. Even some context where the users is an administrator the account has two security tokens one  on medium and the other on high integrity. Some actions required high integrity  level even as administrative user.