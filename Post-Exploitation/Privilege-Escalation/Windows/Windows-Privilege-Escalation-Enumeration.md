# Windows Escalation Vectors Enumeration
This article contain manual enumeration commands and methods to potential find a a vector of escalation. For vectors of privilege escalation see [[Windows-Privilege-Escalation-Vectors]]

## General Enumeration:
```powershell
ver                            # get version
echo %PROCESSOR_ARCHITECTURE%  # Evasive way of bit info
tasklist /svc                  # list all services
tasklist /m                    # list all processes and dlls
systeminfo                     # list system information
hostname                       #
vssadmin                       # volume shadow copy service admin # need admin may one day be useful
wmic qfe get Caption,Description,HotFixId,InstalledOn           # Patch level!
wmic qfe list                  # LIST patch history!!!
$PSVersionTable.PSVersion


Get-ChildItem -Hidden -Path    # String in hidden files 
findstr /si string *.extension # find patterns from current directory and recursively
```


## User and Admin Enumeration
```powershell
whoami /priv
net user # "" insert user name if required with quotes 
get-netuser | out-gridview
get-netuser | select -expandproperty lastlogon
(Get-NetUser).name
Get-LocalUser -Name "Administrator" | Select Name,SID
# Logged in
query user /server:$SERVER
net group "administrators" # /domain
```

## ConsoleHost history file:
```powershell
type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt

(Get-PSReadlineOption).HistorySavePath
```

## Important Windows Locations
[[PrivEsc-Important-Windows-Location]]

## World Writable Files and Directories
```powershell
Get-ChildItem "C:\Program Files" -Recurse | Get-ACL | ?{$_.AccessToString -match "Everyone\sAllow\s\sModify"}

accesschk.exe -uws "Everyone" "C:\Program Files"
accesschk.exe -uwdqs "Users" "c:\*" /accepteula
accesschk.exe -uwdqs "Authenticated Users" "c:\*" /accepteula
accesschk.exe -uwdqs "Everyone" "c:\*" /accepteula
accesschk.exe -uwqs "Users" * /accepteula
accesschk.exe -uwqs "Authenticated Users" * /accepteula
accesschk.exe -uwqs "Everyone" * /accepteula
```

## Device Driver and Kernel Modules Queries
```powershell
driverquery
sc query windefend # requires NAME use get-ciminstance here for memory
sc queryex type=service
get-ciminstance -namespace root/securitycenter2 -classname antivirusproduct

driverquery.exe /v /fo csv | ConvertFrom-CSV | Select-Object ‘Display Name’, ‘Start Mode’, Path

Get-WmiObject Win32_PnPSignedDriver | Select-Object DeviceName, DriverVersion, Manufacturer | Where-Object {$_.DeviceName -like "*$SOMETHING*"}
```

## Network Enumeration
```powershell
Get-NetComputer -ping
netstat -ano # -a displays all active connections, -n prevents name resolution, -o display the pid for each connection
arp -a
ipconfig /all                                    # check dns server
1..15 | %(echo "10.10.10.$_"; ping -n 1 10.10.10.$_ | Select-String tt1)         # ip ping sweep 
1..1024 | %(echo ((New-Object Net.Sockets.TcpCLient).Connect("10.10.10.10", $_)) "Open port on - $_" 2>$null # Port scan
```

## Hotfix levels
```powershell
get-hotfix
get-hotfix | format-list | findstr InstalledOn
get-hotfix | format-table hotfixid
get-hotfix -ID  # specific information

wmic product get name, version, vendor
wmic qfe get Caption, Description, HotFixID, InstalledOn
```

## Unmounted Disks
```powershell
mountvol
```

## Host Sercurity Enumeration
[`GetCimInstance`](https://docs.microsoft.com/en-us/powershell/module/cimcmdlets/get-ciminstance?view=powershell-7.2) maybe configured to not be avaliable for non-users, but may end up needing them to pivot through a network after inital PrivEsc.

Firewalls enumeration powershell
```powershell
Get-NetFirewallProfile | Format-Table Name, Enabled
# Tear down the WALL
Set-NetFirewallProfile -Profile Domain, Public, Private -Enable False
# Show rules
Get-NetfirewallRule | select Display, Enabled, Description
```
and with cmd.exe:
```batch 
netsh advfirewall firewall show rule name=all
```
Testing a firewall from the inside:
```powershell
Test-NetConnection -ComputerName 127.0.0.1 -Port 80
```

Eventlogs sometimes provide an insight into applications and services, security or otherwise
```powershell 
Get-EventLog -List
```

Windows Defender
```powershell 
Get-Service WinDefend
# Check Windows Defender Enabled
Get-MpComputerStatus | Select RealTimeProtectionEnabled 
Set-MpPreference -DisableRealtimeMonitoring $true

# Registry Key
HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows Defender

sc stop WinDefend
sc start WinDefend
```

AV
```powershell
wmic / :\\ \  path antivirusproduct
Get-CimInstance -Namespace <name/space> -ClassName AntivirusProduct
```

Sysmon Enumeration
```powershell
Get-CimInstance win32_service -Filter "Description = 'System Monitor service'"
Get-Service | where-object {$_.DisplayName -like "*sysm*"}
reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Channels\Microsoft-Windows-Sysmon\Operational
```
If you find Sysmon, find the config file.
```powershell
 findstr /si '<ProcessCreate onmatch="exclude">' C:\* # BEWARE recursive searching!
```

## WMI-Obejcts
```powershell
Get-WmiObject win32_useraccount | Select name,sid
gvmi win32_userprofile
#Get Computer system information
Get-WMIObject Win32_ComputerSystem
#Get Computer name from available System information
Get-WMIObject Win32_ComputerSystem| Select-Object -ExpandProperty Name
#Get Domain name from available System Information
Get-WMIObject Win32_ComputerSystem| Select-Object -ExpandProperty Domain

net localgroup # "" insert group name if required with quotes
Get-Net-Group
Get-NetGroupMember "Domain Admins"
Get-NetUsers -Domain

get-netdomaincontroller

cmdkey /list # Saved Creds!
runas /savecred /user:<user> cmd.exe
```

## Software
```powershell
get-executionpolicy -list
set-executionpolicy bypass -scope process # Change executionpolicy
wmic product get name,version,vendor
wmic service list brief
wmic service list brief | findstr  "Running"
sc qc <service>
```

## Services
```powershell
wmic service where "name like 'InsecureProcess'" get Name, PathName
Get-Process -Name <name>
# Network Service Enumeration
netstat -noa |findstr "LISTENING"|finder "<ProcessID>"
```

DNS Zone Transfer with `nslookup`
```
nslookup.exe
>server IP 
>ls -d domainname.com
```