# Shellcode Defined

Shellcode is a set of machine code instructions that executes a payload within the runtime context of vulnerable software to then exploit a machine. It is written in Assembly Language ans translated into hexadecimal operational codes. Shellcode is injected into a process and executed vulnerable software or program. When writing [[Antivirus-Evasion-Shellcode]] the unique and custom wins. Either Assembly, C programming or `shellcraft` with [[Pwntools]] are required along with knowledge of CPU architectures and the operating systems the target shellcode to run on.


Syscalls (System Calls) are function that a program requests the kernel to perform either create, read, update, delete (CRUD), but also more specific contextual function like load and exit. 

Complete reference of available 64-bits Linux Syscalls 
- [https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/](https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/)


## Shellcode Links

Linux 32bit `/bin/sh` x86 https://packetstormsecurity.com/files/115010/Linux-x86-execve-bin-sh-Shellcode.html

Windows x86 WinExec("cmd.exe",0) shellcode https://packetstormsecurity.com/files/137384/Windows-x86-WinExec-cmd.exe-0-Shellcode.html

## Shellcode Writing and Generating

#### Writing

[nasm](https://www.nasm.us/doc/) - the Netwide Assembler, a portable 80x86 assembler, [ld - GNU linker](https://linux.die.net/man/1/ld)
```bash
nasm -f $ARCH FILE.asm
# Linux
nasm -f elf64 test.asm
ld test.o -o test
./test
# Extract shellcode dumping the .text section with objdump 
objdump -d test
# Dump to a file with objcopy
objcopy -j .text -O binary test test.text
# xxd to convert binary formatted shellcode to hex
xxd -i test.text > test.c
# Compile 
gcc -g -Wall -z execstack test.c -o testx
```

#### Generator Tools 

[[Metasploit]]'s - `msefvenom` see default list of [[MSFvenom-Payloads]]
[[ScareCrow]] payload creation framework designed around EDR bypass.

#### Generate Shellcode from EXE Files

`.bin` is a raw data format `xxd` will convert raw binary to hex and print it in a [[Useful-C]] format.
```bash
xxd -i test.bin
```

## References

[https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/](https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/)
[packetstormsecurity](x86 https://packetstormsecurity.com/files/)
[THM AV evasion shellcode](https://tryhackme.com/room/avevasionshellcode)