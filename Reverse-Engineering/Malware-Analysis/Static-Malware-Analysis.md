# Static Malware Analysis

The primary concern regarding performing static analysis on malware in a live environment is an accidental execution. Use a [[Malware-Sandbox]]. Be safe. Probably best practice to have entire dedicated host machine for Malware Analysis. Although [[Hypervisor-Escapes]] exist, why gamble a good machine(s) or hardware. Cost versus Risk is easily solved by spending the money on a dedicated setup.


#### What is the file hash and what Online Malware Analysis communities say?

```bash
md5sum
shasum -a <algorhythm>
```

#### What is the file hash per section 

Malware Writer may patch binaries instead of recompiling, rebuilding, etc - changes in PE head er sections  

#### Import hashes of Windows Malware?

`imphash` - [Mandiant Imphash blog](https://www.mandiant.com/resources/blog/tracking-malware-import-hashing), is hash of function calls/ libraries that potential malware imports.

#### Is it identifiable as Malware by using Fuzzy Hashed

A Fuzzy hash is a Context Triggered Piecewise Hash (CTPH). This hash is calculated by dividing a file into pieces and calculating the hashes of the different pieces. This method creates multiple inputs with similar sequences of bytes, even segmented though the whole file might be different.

- Use [SSDEEP](https://ssdeep-project.github.io/ssdeep/index.html), it can calculate hashes of similar files

#### What Strings are used?

`Strings` 

No SysInternals no problem from [Michael K. Steinberg](https://superuser.com/questions/124081/is-there-a-windows-equivalent-of-the-unix-strings-command)
```
more < $file.exe | findstr "." > strings.txt
```

#### What is the composition of binary?

Linux:
```bash
readelf
```

[[Malware-Analysis-PE-Headers]] for Window Portable Executable

#### What calls to kernel are made?  

Consider reading Windows API resources for Malware Analysis at [MalAPI](https://malapi.io/)Â or [MSDN](https://docs.microsoft.com/en-us/search/?scope=Desktop&terms=queryperformancecounter).

#### What signatures are detected?

- [[Yara]] and community [Yara Rules](https://github.com/Yara-Rules/rules)
- [Virustotal](https://www.virustotal.com/gui/home/upload)
- [Capa](https://github.com/mandiant/capa)

[MITRE ATT&CK external](https://attack.mitre.org/) or [(locally)](MITRE-ATT&CK]]) and [Malware Behavior Catalog (MBC)](https://github.com/MBCProject/mbc-markdown)

Using a Disassembler to analyse the suspicious file with executing or partial execution. Try:
- [[Radare2-Commands]] and [[Radare2-Cheatsheet]]
- [[Ghidra-Cheatsheet]]
- [[IDA]]

Debuggers
- [[VS-Code]], ILspy, dnSpy
- [[Immunity-Debugger-Helpsheet]]
- [[EDB]]
- [[GDB]]

[Detect it easy](https://github.com/horsicq/Detect-It-Easy) is file analysis program providing file information, architecture, significant headers, packer used, strings. It utilizes an open architecture of signatures, using Javascript-like scripting language.

[CAPA](https://github.com/mandiant/capa) is The FLARE team's open-source tool to identify capabilities in executable files.
- MBC Objective and Behaviour
- Provides [[MITRE-ATT&CK]]1 tactics and techniques identification

```powershell
udp -d # unpack upx packed binary
```
