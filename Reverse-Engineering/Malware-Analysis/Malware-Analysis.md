# Malware Analysis

The term Malware is derived from the contraction of Malicious and Software and in combination to refer to software that has malicious intent. Analysis generally is dichotomised by temporality: static as the malware is does not run, but is read/parsed by analysts and tooling; dynamic as the malware is executed and observed for its behaviour. Furthermore analysis can occur on workflow of using [[Reverse-Engineering-Tools]] like disassemblers, debuggers, etc like regular software to understand how it works.

Malware Analysis is used by all sides:

- **Security Operations** teams analyse malware to write detections for malicious activity in their networks.
- **Incident Response** teams analyse malware to determine what damage has been done to an environment to remediate and revert that damage.
- **Threat Hunt** teams analyse malware to identify IOCs, which they use to hunt for malware in a network.
- **Malware Researchers** in security product vendor teams analyse malware to add detections for them in their security products.
- **Threat Research** teams in OS Vendors like Microsoft and Google analyse malware to discover the vulnerabilities exploited and add more security features to the OS/applications.
- **Malware Writers** to improve there own malware use modern malware analysis tools and techniques to bypass 
- **Threat Emulators, Red Teams and APTs** to replicate functionality without destructive outcomes to demonstrate emulation of the threat APTs tactics and techniques without the destructive results or real APTs doing real APT things.

Generally if you are performing Blue/Purple team operation use want community information of the sample: [VirusTotal](https://www.virustotal.com/) tracks AV vendors and Malware sampling.


## Environments

- FLARE VM: - Windows 7/10 VM plus [FLARE GitHub page](https://github.com/mandiant/flare-vm) or from the [Mandiant blog](https://www.mandiant.com/resources/blog/flare-vm-update)
- REMnux -  [GitHub](https://github.com/REMnux) or the [website](https://remnux.org/) for distribution
- [[IDA-Malware-Reverse-Engineering-101-By-Jake-Williams-Notes]] contains an application list as well good ideas about environment and operator best practices in a Developer version of Windows 10!

## Methodology

**Malware can dangerous!**

- Where possible have separate dedicated machines for Static and Dynamic Analysis. 
- Do not connect the to a network or internet, create a [[Fake-System-And-Network-Infrastructure-For-Malware-Analysis]]
 
- Create documentation as you analyze

## Analytic Typology

- [[Static-Malware-Analysis]]
- [[Dynamic-Malware-Analysis]]


## Threat Tracking 

**AlienVault Open Threat Exchange (OTX)** - An open-source threat tracking system. Create pulses based on your malware analysis work and check out the work of others. [Link](https://otx.alienvault.com/dashboard/new)


## PE Header Analysis

The PE File Header contains the metadata about a Portable Executable file - [[Malware-Analysis-PE-Headers]] for more details, but brief
- Import/Exports
- Sections 
	- .text - CPU instructions
	- .data - global data
	- .rsrc - resouces used by the PE file 

Tools for PE analysis
`pecheck` 

## Anti-Analysis techniques

[[Malware-Techniques-Packing]] 
[[Malware-Techniques-Obfuscation]]


## References

[Sandbox Evasion THM Room](https://tryhackme.com/room/sandboxevasion)
[Malware Behavior Catalogue (MBC)](https://github.com/MBCProject/mbc-markdown)
[Volalitility THM Room](https://tryhackme.com/room/bpvolatility)
[Intro to Malware Analysis THM](https://tryhackme.com/room/intromalwareanalysis)
[Basic Static Analysis THM room](https://tryhackme.com/room/staticanalysis1)
[Microsoft Documentation about Strings](https://docs.microsoft.com/en-us/sysinternals/downloads/strings)
[Mandiant Imphash blog](https://www.mandiant.com/resources/blog/tracking-malware-import-hashing)[Malware Behavior Catalog (MBC)](https://github.com/MBCProject/mbc-markdown)
[THM Basic Dynamic Analysis Room](https://tryhackme.com/room/basicdynamicanalysis)