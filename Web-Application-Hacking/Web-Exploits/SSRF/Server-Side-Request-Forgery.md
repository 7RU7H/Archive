# Server-Side Request Forgery

Server-Side Request Forgery (SSRF), [PortSwigger](https://portswigger.net/web-security/ssrf) states: *"is a web security vulnerability that allows an attacker to cause the server-side application to make requests to an unintended location."*

Impact:
- Access data within an organisation
- Potential arbitrary command execution

- Types
	- Reflected
	- Blind
	- Affecting the local server
		- Why implicitly trust request that come directly from the local machine:
			- *The [access control](https://portswigger.net/web-security/access-control) check might be implemented in a different component that sits in front of the application server. When a connection is made back to the server, the check is bypassed.*
			- Disaster recovery may require administrative access without authentication from the local machine
				- Assumption of trust the user would come directly from the server
			- Administrative interface might listen on a different port to the main application - not reachable directly by users. 
	- Affecting back-end systems
		- Protected by network topology (often non-routable private IP address), but weaker security posture
- Indicators:
	- Full URL used in a parameter in address bar
	- Hidden field in a form
	- Partial URL as just a `hostname`
	- Path of a URL 
- Bypassing SSRF defences
	- SSRF Blacklist-based input filters
		- Alternate IP representations
		- Registering a domain that resolves to `127.0.0.1` - `spoofed.burpcollaborator.net`
		- Obfuscate blocked strings using URL encoding, case variation
		- Provide a controlled URL that redirects to the target URL
			- Try different:
				- Redirection codes
				- Protocols 
	- SSRF Whitelist-based input filters 
		- Combinations of or singularly (exploitation of inconsistencies in URL):
			- Embedded credentials using `@`
			- URL fragments `#` `https://url#expected-host`
			- Leverage DNS naming hierarchy with controlled FQDN `https://expected-host.evil-host`
			- URL encoding characters to confuse the URL-parsing code (especially if there is asymmetry in how the filter handles URL encoded characters to the code that executes the back-end request)
				- Double encoding	

## Mitigation

- Deny List
- Allow List
- Open redirect 

## References

[PortSwigger SSRF](https://portswigger.net/web-security/ssrf) 
[PortSwigger Access Control](https://portswigger.net/web-security/access-control)
[THM Room SSRF](https://tryhackme.com/room/ssrfqi)