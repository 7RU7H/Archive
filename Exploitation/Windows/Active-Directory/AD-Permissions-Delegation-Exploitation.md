# Active Directory Permissions Delegation Exploitation

Active Directory can delegate permissions and privileges through a feature called Permission Delegation (not to be confused with Kerberos Delegation see [[AD-Kerberos-Delegation-Exploitation]]). It allows for centralised control to delegate entire set of OUs of a *insert-typological-structure-of-AD* to perform a various tasks. I this section use may need theses powershell commands or equivalent from bypassing non-access to AD powershell related commands if blocked for your current context.

```powershell
Get-ADGroupMember -Identity "<group name>"
```

Access Control Entries populate the [[Windows-Discretionary-Access-Control-List]] notable examples:

ACE | Misconfiguration Details | AD Powershell Command
---  |  --- | ---
ForceChangePassword | We have the ability to set the user's current password without knowing their current password. | `$Password = ConvertTo-SecureString "New.Password.For.User" -AsPlainText -Force ; Set-ADAccountPassword -Identity "AD.Account.Username.Of.Target" -Reset -NewPassword $Password` 
AddMembers | We have the ability to add users (including our own account), groups or computers to the target group. | `Add-ADgroupmember "<group>" -Members "<username>"`
GenericAll | We have complete control over the object, including the ability to change the user's password, register an SPN or add an AD object to the target group.
GenericWrite | We can update any non-protected parameters of our target object. This could allow us to, for example, update the scriptPath parameter, which would cause a script to execute the next time the user logs on.
WriteOwner | We have the ability to update the owner of the target object. We could make ourselves the owner, allowing us to gain additional permissions over the object.
WriteDACL | We have the ability to write new ACEs to the target object's DACL. We could, for example, write an ACE that grants our account full control over the target object.
AllExtendedRights | We have the ability to perform any action associated with extended AD rights against the target object. This includes, for example, the ability to force change a user's password.

Attack paths are then dependent on analysis of either using [[Neo4j-And-Bloodhound-Guide]] and relevant software or another of the [[AD-Hacking-Tools]] to enumerate a path to privilege escalate or move laterally in the network or on the host. 

## References

[Bloodhound Documentation](https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html#)
[THM Room Exploiting AD](https://tryhackme.com/room/exploitingad)