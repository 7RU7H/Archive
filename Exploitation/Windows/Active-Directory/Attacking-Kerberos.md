# Attacking Kerberos
For enumeration see [[Active-Directory-Enumeration-Defined]] or general theory and definitions [[Active-Directory-Defined]]. For commands cheatsheet [[Active-Directory-Commands]] or for Privilege Escalation see [[Active-Directory-Privilege-Escalation]].

## Tools
[[Kerbrute-Cheatsheet]]
[[Impacket-Cheatsheet]]
[[Crackmapexec-Cheatsheet]]
[[Mimikatz-Cheatsheet]]
[[Rubeus-Cheatsheet]]

## Attack Privilege Requirements
Attack |  Requirements
--- | ---
Kerbrute Enumeration | No domain access required 
Pass the Ticket | Access as a user to the domain required
Kerberoasting | Access as any user required
AS-REP Roasting | Access as any user required  
Golden Ticket | Full domain compromise (domain admin) required 
Silver Ticket | Service hash required 
Skeleton Key | Full domain compromise (domain admin) required

## Misconfigurations to look for:
Service Accounts that are Domain Admins

## Service Account Attacks
To attack a targeted Service with request service ticket from the DC - no checks are performed on whether the user that has request that ticket has any permissions to access the service hosted by the service principal name ; it is **only checked attempting to connect to the service**.

The request service ticket can be extracted from local memory and saved. [[Useful_Powershell]] `KerberosRequestorSecurityToken` can be used to request the service ticket.
```powershell
TargetServicePrincipleName=''
Add-Type -AssemblyName System.IdentityModel
New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList $TargetServicePrincipleName
```
Instead of tools like [[Mimikatz-Cheatsheet]] you can use the builtin `klist` command can be used to display all cached Kerberos tickets of a current user an example of [[Active-Directory-Credential-Caching]]. This service ticket is encrypted using the SPN's password hash. We need to request the ticket and decrypt it using Kerberoasting. We do not need Administrative privileges.

## Attacks 

- [[Pass-The-Key]]
- [[Pass-The-Ticket]]

## References

[THM Room Exploiting AD](https://tryhackme.com/room/exploitingad)
[Wikipedia](https://en.wikipedia.org/wiki/Kerberos_(protocol))
[THM Room Attacking Kerberos](https://tryhackme.com/room/attackingkerberos)
