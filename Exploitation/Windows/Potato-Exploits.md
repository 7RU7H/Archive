# Potato Exxploits

First read this incredible blog post from [jlajara](https://jlajara.gitlab.io/Potatoes_Windows_Privesc). 




Check architecture!
```powershell
# Always check this
set pro
# Regulars
systeminfo
get-computerinfo
```

- Potato
	- https://github.com/foxglovesec/Potato.git
- [Hot Potato](https://jlajara.gitlab.io/Potatoes_Windows_Privesc#hotPotato)
- [Rotten Potato](https://jlajara.gitlab.io/Potatoes_Windows_Privesc#rottenPotato)
	- https://github.com/breenmachine/RottenPotatoNG.git
- [Lonely Potato](https://jlajara.gitlab.io/Potatoes_Windows_Privesc#lonelyPotato)
- [Juicy Potato](https://jlajara.gitlab.io/Potatoes_Windows_Privesc#juicyPotato) - [CLSIDs](https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md)
	- [JuicyPotatoNG](https://github.com/antonioCoco/JuicyPotatoNG) and the [Blog](https://decoder.cloud/2022/09/21/giving-juicypotato-a-second-chance-juicypotatong/)
	- https://github.com/ohpe/juicy-potato.**git**
- [Rogue Potato](https://jlajara.gitlab.io/Potatoes_Windows_Privesc#roguePotato)
	- https://github.com/antonioCoco/RoguePotato.git
- [Sweet Potato](https://jlajara.gitlab.io/Potatoes_Windows_Privesc#sweetPotato)
	- https://github.com/CCob/SweetPotato.git
- [Generic Potato](https://jlajara.gitlab.io/Potatoes_Windows_Privesc#genericPotato)
	- https://github.com/micahvandeusen/GenericPotato.git

- Similar
	- PrintSpoofer uses `seImpersonatePrivilege` - https://github.com/itm4n/PrintSpoofer.git
	- As does RogueWinRM https://github.com/antonioCoco/RogueWinRM 

#### `seImpersonatePrivilege`

User requires either SeAssignPrimaryTokenPrivilege or `seImpersonatePrivilege` to impersonate System. These privilege are used legitimately for patching by services and software to perform task that require system level access. The exploit attempt to activate a local [COM object](https://en.wikipedia.org/wiki/Component_Object_Model) (a binary interface to for inter-process communication) using an SSPI hook on _[AcceptSecurityContext()](https://learn.microsoft.com/en-us/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext)_ function to then force an authentication attempt that is capture by the exploit and abuse to elevate to system to perform a specified command by user. Consider the [[SePrivilege-Token-Table]] for full coverage of these security tokens.

#### CLSID Selection

Beware of the [CLSIDs](https://learn.microsoft.com/en-us/windows/win32/com/clsid-key-hklm): *A CLSID is a globally unique identifier that identifies a COM class object. If your server or container allows linking to its embedded objects, you need to register a CLSID for each supported class of objects.* Registry Key found here: `HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID\{CLSID}`

#### Compilation

Always check before compilation, do not use static binaries for non-CTFs. 

Requires [[Compiling-Exploits]] or [[Microsoft-Visual-Studios]] 2019! - 4.5 not supported by 2022 onwards. 

## References

[jlajara](https://jlajara.gitlab.io/Potatoes_Windows_Privesc)
[Decoder Blog about JuicyPotatoNG](https://decoder.cloud/2022/09/21/giving-juicypotato-a-second-chance-juicypotatong/)
[ohpe - CLSIDs](https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md)
[HackTricks](https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens)
