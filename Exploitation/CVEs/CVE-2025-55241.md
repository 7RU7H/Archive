# CVE-2025-55241


[CVE-2025-55241](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-55241) found by  [Dirk-jan (GitHub)](https://github.com/dirkjanm): [BlackHat/DEFCON 33 Slides](https://dirkjanm.io/assets/raw/dirkjan%20-%20DC33%20-%20Advanced%20Active%20Directory%20to%20Entra%20ID%20lateral%20movement%20techniques_final.pdf) and the his blog [dirkjanm.io - One Token to rule them all - obtaining Global Admin in every Entra ID tenant via Actor tokens](https://dirkjanm.io/obtaining-global-admin-in-every-entra-id-tenant-with-actor-tokens/)

1. Undocumented impersonation tokens, called “Actor tokens”, that Microsoft uses in their backend for service-to-service (S2S) communication

This was chain-able with a critical flaw in the (legacy) Azure AD Graph API that failed to properly validate the originating tenant, thus any tenant administrator on the globe could be impersonated.

Actor tokens are tokens that are issued by the `Access Control Service` (author claims unknown origin). Exchange and other applications will request Actor tokens when communicating with other services on behalf of a user. The Actor token allows it to "act" as another user in the tenant when talking to Exchange Online, SharePoint and Azure AD Graph (potential others). The Actor token is a JSON Web Token (JWT see [[JSON-Web-Tokens]]).



[ROADtools Github](https://github.com/dirkjanm/ROADtools/blob/master/roadtx/roadtools/roadtx/main.py)

Action token had the following properties:
- Valid for 24 hours.
- Non-revokable.
- No logs when they are issued.
- Unsigned – so no traffic to Entra ID to use them – so again no logs.
-  Can impersonate anyone within the tenant for tokens that have
`trustedfordelegation`, which most MSFT apps [Dirk-jan (GitHub)](https://github.com/dirkjanm) tested have.
- No Conditional Access or any security checks at all.
- Valid for any mailbox in Exchange online.
- Can also be requested for SharePoint online, access any SharePoint site/OneDrive in the tenant.
- Since these services can craft the unsigned impersonation tokens without talking to Entra ID, there are also no logs when they are created or used.
- They completely bypass any restrictions configured in Conditional Access.
- We have to rely on logging from the resource provider to even know these tokens were used in the tenant.

From a Entra ID lab or tenant:
Request actor token
```bash

# Use ROADtx to query with the token the `netId` of a Global Admin
roadtx graphrequest $url

```

 
HTTP Requests are used with this header
```powershell
# $tokenobject = action token 
Authorization: Bearer $tokenobject["accessToken"]
```

Detection Query from blog thanking Fabian Bader and Olaf Hartong:
```kql
AuditLogs
| where not(OperationName has "group")
| where not(OperationName == "Set directory feature on tenant")
| where InitiatedBy has "user"
| where InitiatedBy.user.displayName has_any ( "Office 365 Exchange Online", "Skype for Business Online", "Dataverse", "Office 365 SharePoint Online", "Microsoft Dynamics ERP")
```

## References

[CVE-2025-55241](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-55241)
[Dirk-jan (GitHub)](https://github.com/dirkjanm)
[BlackHat/DEFCON 33 Slides](https://dirkjanm.io/assets/raw/dirkjan%20-%20DC33%20-%20Advanced%20Active%20Directory%20to%20Entra%20ID%20lateral%20movement%20techniques_final.pdf)
[ROADtools Github](https://github.com/dirkjanm/ROADtools/blob/master/roadtx/roadtools/roadtx/main.py)