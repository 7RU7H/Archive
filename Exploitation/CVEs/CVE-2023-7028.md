# CVE-2023-7028

This [GitLab](https://about.gitlab.com/releases/2024/01/11/critical-security-release-gitlab-16-7-2-released/) critical vulnerability allowed an attacker to supply two email address to a reset password request and the reset code would be spent to both emails. All instances of GitLab CE/EE using the following versions were vulnerable:
- 16.1 to 16.1.5
- 16.2 to 16.2.8
- 16.3 to 16.3.6
- 16.4 to 16.4.4
- 16.5 to 16.5.5
- 16.6 to 16.6.3
- 16.7 to 16.7.1

`POST /users/password` to GitLab API endpoint - [source code](https://gitlab.com/gitlab-org/gitlab-foss/-/commit/21f32835ac7ca8c7ef57a93746dac7697341acc0) of the GitLab 16.1 (CE) stable version; the `spec/controllers/passwords_controller_spec.rb` accepts multiple emails as input. An attacker would only required the `authenticity_token` during form submission and the victim's email address to exploit this. 

- [Vozec 's PoC for CVE-2023-7028](https://github.com/Vozec/CVE-2023-7028/blob/main/CVE-2023-7028.py)

#### Detection and Mitigation

Mitigation:
- Patch version
- Enable two-factor authentication (2FA) for all GitLab accounts
- Follow [[Secure-Coding]] practices
Detection:
- Logging:
	- Check weblogs for API calls to `/users/password` with multiple email addresses.
	- Inspect email server logs for  additional email recipients
	- Examine GitLab audit logs for entries containing a value for `meta.caller.id` as `PasswordsController#create`.


## References

[GitLab](https://about.gitlab.com/releases/2024/01/11/critical-security-release-gitlab-16-7-2-released/)
[THM Room - GitLab CVE-2023-7028](https://tryhackme.com/room/gitlabcve20237028)
[Vozec 's PoC for CVE-2023-7028](https://github.com/Vozec/CVE-2023-7028/blob/main/CVE-2023-7028.py)
[Gitlab 16.1 (CE) stable version source code](https://gitlab.com/gitlab-org/gitlab-foss/-/commit/21f32835ac7ca8c7ef57a93746dac7697341acc0)