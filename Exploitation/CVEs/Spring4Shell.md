# Spring4Shell


[[Java]] [Spring framework](https://spring.io/) in [late March and early April 2022](https://spring.io/blog/2022/03/31/spring-framework-rce-early-announcement) was affected by two RCEs, one that was leaked out ahead of CVE publication and was confusion with the first being a [CVE for Spring Cloud Function](https://spring.io/blog/2022/03/29/cve-report-published-for-spring-cloud-function), which was released just before the report for this vulnerability. Spring considered it unrelated.

Spring MVC (Model View Controller) is build tool to for Spring. [Spring MVC serves web content by first Initalization of dependecies and secondly requires programing of a web controller (a Java class) to handle HTTP request (with methods of that class), which is then deployed.](https://spring.io/guides/gs/serving-web-content/). Spring implements MVC with the [front controller pattern using its _DispatcherServlet_](https://www.baeldung.com/spring-controllers#Overview) - [Ref](https://www.baeldung.com/spring-mvc-tutorial).

The first (affecting `Spring Cloud Functions`) was publicly disclosed RCE 0day as bypass for [CVE-2010-1622 patch](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-1622), which patched an RCE *"via an HTTP request containing `class.classLoader.URLs[0]=jar`: followed by a URL of a crafted .jar file."* - [Spring's report on CVE-2022-22963](https://spring.io/blog/2022/03/29/cve-report-published-for-spring-cloud-function) 
- Consider [o0o Writeup for CVE-2010-1622](http://blog.o0o.nu/2010/06/cve-2010-1622.html)

The second (affecting `Spring Core`) is the Spring4Shell vulnerability. It affects Spring Core versions < 5.2, 5.3.0-17 and 5.2.0-19; including Spring running Java Development Kit (JDK) >= 9. [CVE-2022-22965] is reliant on a insecure access to ClassLoader in Java 9+ that be used to upload files unauthenicated.
- Only [[Apache-Tomcat]] 
- Spring must be packaged as a WAR - .war
- Requires `spring-webmvc` and/or `spring-webflux` components of the Spring Framework on the server.

#### Tooling

[Detection and exploitation guide from Pentest-Tools.com](https://pentest-tools.com/blog/detect-exploit-spring4shell-cve-2022-22965)
[Nuclei template for Spring4Shell](https://raw.githubusercontent.com/projectdiscovery/nuclei-templates/master/cves/2022/CVE-2022-22965.yaml)

[BobTheShopLifter's Spring4Shell PoC](https://github.com/BobTheShoplifter/Spring4Shell-POC)
[NCSC-NL Spring4Shell](https://github.com/NCSC-NL/spring4shell)


#### Futher Reading

[LunaSec Blog Post](https://www.lunasec.io/docs/blog/spring-rce-vulnerabilities/)
[Praetorian Blog Post](https://www.praetorian.com/blog/spring-core-jdk9-rce/)

#### Remedations

- Upgrade [[Apache-Tomcat]]
- Downgrading to Java 8
- Another viable workaround is to disable binding to particular fields by setting `disallowedFields`on `WebDataBinder` globally - [See full](https://spring.io/blog/2022/03/31/spring-framework-rce-early-announcement)

## References

[THM Spring4Shell Room](https://tryhackme.com/room/spring4shell)
[cve.mitre - CVE-2010-1622](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-1622)
[Spring framework](https://spring.io/)
[Pentest-Tools CVE-2022-22965](https://pentest-tools.com/vulnerabilities-exploits/spring-core-remote-code-execution_CVE-2022-22965)
[Dark Reading article](https://www.darkreading.com/vulnerabilities-threats/spring-fixes-zero-day-vulnerability-in-framework-spring-boot)
[Spring Documentation - Serving Web Content](https://spring.io/guides/gs/serving-web-content/)
[Baeldung - Spring MVC Tutorial](https://www.baeldung.com/spring-mvc-tutorial)
[Spring Framework RCE, Early Announcement](https://spring.io/blog/2022/03/31/spring-framework-rce-early-announcement)
[o0o Writeup for CVE-2010-1622](http://blog.o0o.nu/2010/06/cve-2010-1622.html)
[Nuclei template for Spring4Shell](https://raw.githubusercontent.com/projectdiscovery/nuclei-templates/master/cves/2022/CVE-2022-22965.yaml)
[LunaSec Blog Post](https://www.lunasec.io/docs/blog/spring-rce-vulnerabilities/)
[Praetorian Blog Post](https://www.praetorian.com/blog/spring-core-jdk9-rce/)
[Detection and exploitation guide from Pentest-Tools.com](https://pentest-tools.com/blog/detect-exploit-spring4shell-cve-2022-22965)