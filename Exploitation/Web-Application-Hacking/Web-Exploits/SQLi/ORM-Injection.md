# ORM Injection

Object-Relational Mapping (ORM) according to [Wikipedia Objectâ€“relational_mapping](https://en.wikipedia.org/wiki/Object%E2%80%93relational_mapping): states: *"is a [programming](https://en.wikipedia.org/wiki/Computer_programming "Computer programming") technique for converting data between a [relational database](https://en.wikipedia.org/wiki/Relational_database "Relational database") and the [heap](https://en.wikipedia.org/wiki/Memory_management#HEAP "Memory management") of an [object-oriented](https://en.wikipedia.org/wiki/Object-oriented "Object-oriented") programming language"*. [THM Room ORM Injections](https://tryhackme.com/r/room/orminjection): *"ORM is a programming technique that facilitates data conversion between incompatible systems using object-oriented programming languages ... ORM is a technique that simplifies data interaction in an application by mapping objects in code to database tables."*. ORM is used as a mitigation against [[SQL-Injection]], but ORM injection is the exploitation of vulnerabilities of the underlying ORM framework to execute arbitrary queries.

Purpose
- Reduce Boilerplate
- Reduce SQL queries
- Intermediary for complex database interaction.
- Consistency
- Maintainability 
- Productivity


ORM Frameworks:
- Doctrine (PHP)
- Laravel's Eloquent (PHP)
- Hiberate (Java)
- SQLAlchemy (Python)
- Entity Framework (C\#)
- Active Record (Ruby on Rails)

ORM in practice:
- Define class to represent database tables and their relationships
- [[CRUD]] methods

ORM Injection exploiting how it constructs queries from object operations.
```php
$userRepository->findBy(['username' => "admin' OR '1'='1"]);
```

So similarly to SQL Injections the initial starting point is to play a game of *"Guess The ORM Query* and then SQL Inject (with payload being slightly harder to detect as they are within the ORM query according to THM)


## Mitigation

- Proper ORM configuration 
- Application-level input validation
- ORM features enforcing query safety
## References

[THM Room ORM Injections](https://tryhackme.com/r/room/orminjection)