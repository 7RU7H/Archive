# Aurora 

Aurora EDR is a [[Sigma]]-based Windows endpoint agent that uses Sigma rules and IOCs for writing detections on patterns on local event streams using [[ETW]]. According to [NexTron-Systems.com](https://www.nextron-systems.com/aurora/): *"The AURORA Agent is a lightweight and customisable EDR agent based on [Sigma](https://github.com/SigmaHQ/sigma). It uses Event Tracing for Windows (ETW) to recreate events that are very similar to the events generated by Microsoft’s [Sysmon](https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon) and applies Sigma rules and IOCs to them. AURORA complements the open Sigma standard with “response actions” that allow users to react to a Sigma match."*

- See [[ETW]]
- [[EDR]] for more broader articulation of the possible capabilities of vendors. 

It is everything that other EDRs aren’t: 
- it is completely transparent and fully customisable due to the open Sigma rule set and configuration files
- it saves 99% of the network bandwidth and storage
- it works completely on-premises, no data leaves your network
- it can be configured to use only a limited amount of resources

If ETW is disabled by attacker
- Use the ETW Canary module to detect any manipulations of ETW
#### Presets

- **Standard:** This configuration covers events at a medium level of severity.
- **Reduced:** This configuration looks at events considered to be at a high minimum reporting level.
- **Minimal:** This configuration looks at events considered to be at a high minimum reporting level.
- **Intense:** This configuration looks at events considered to be at a low minimum reporting level.
	- For Named Pipes 
		- use Sysmon ([[Sysinterals-Sysmon]]) and Intense Preset
	- Registry Events
		- use Sysmon ([[Sysinterals-Sysmon]]) and Intense Preset

#### Responses

Predefined:
- **Suspend:** Used to stop a specified process.
- **Kill:** Used to kill a specified process.
- **Dump:** Used to create a dump file found in the `dump-path` folder.
Custom
- Simulate: Used to test out rules, and responses that won't be triggered. A log will be created to indicate the type of response that would be triggered.
- Recursive: It is used to specify that the response will affect descendent processes
- Low privilege only: Marked by the flag `lowprivonly.` The flag specifies that the response will be triggered if the target process does not run as `LOCAL SYSTEM` or at an elevated role.
- Ancestor: The `ancestors` flag specifies that the response will affect a process’s ancestor, not itself - 1 = parent, 2 = grand parent process. 
- Process ID field: The `processidfield` flag specifies the field contains the process ID that shall be affected by the response.

#### Running Aurora

```powershell
aurora-agent.exe -c agent-config-minimal.yml
# Continuous running
aurora-agent.exe --install -c agent-config-minimal.yml

# Queries status of currently running service
aurora-agent.exe --status
# Queries all the events from subscribed ETW channels + statistics 
aurora-agent.exe --trace > aurora-trace.log
# Rotated (at 10MB) Log file  
aurora-agent.exe --logfile aurora-trace.log
# Output all alert definitions as JSON
aurora-agent.exe --json
# UDP/TCP Targets
aurora-agent.exe --udp-targets
aurora-agent.exe --tcp-targets
```
#### Function Tests

- Listing user account privileges
- Suspicious network communication
#### Aurora Event IDs

|Event ID|Description|
|---|---|
|1|A process creation Sigma rule matched
|2|A set file creation time sigma rule matched
|3|A network connection sigma rule matched
|4|A sysmon status Sigma rule matched
|5|A process termination Sigma rule matched
|6|A driver-loaded Sigma rule matched
|7|An image-loaded Sigma rule matched
|8|A create remote thread Sigma rule matched
|9|A raw disk access Sigma rule matched
|10|A process access Sigma rule matched
|11|A file creation Sigma rule matched
|12|A registry event Sigma rule matched
|15|A create stream hash Sigma rule matched
|17|A pipe event Sigma rule matched
|19|A WMI event Sigma rule matched
|21|A registry event Sigma rule matched
|22|A DNS query Sigma rule matched
|23|A file deletion Sigma rule matched
|99|Another Sigma rule (that did not belong to one of the above categories) matched
|98|Unspecified log message from Sigma module
|97|No Sigma rule files were found
|96|Sigma rules were reloaded
|95|An error occurred while loading the Sigma rules
|100|A license file was found
|101|Status message (from --report-stats)
|102|Aurora Agent started
|103|Aurora Agent is terminating
|104|The current license expired
|105|No valid license file was found
|107|A process created a large number of events
|108|An internal panic occurred
|200|BeaconHunter
|300|Lsass Dump Detector
|400|ETW Canary
|500|Process Tampering Detector
|600|Temporary Driver Load Detector
|700|Command Line Mismatch Detector
|800|Event Distributor
|900|ETW Provider
|1000|Eventlog Provider
|1100|Handle Polling Provider
|1200|Resource Control
|6000|A response for a sigma match was executed
|6001|A response for a sigma match was simulated
## References

[THM Room Aurora EDR](https://tryhackme.com/room/auroraedr)
[NexTron-Systems.com](https://www.nextron-systems.com/aurora/)