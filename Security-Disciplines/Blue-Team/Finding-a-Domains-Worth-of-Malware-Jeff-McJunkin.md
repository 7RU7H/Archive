

# Finding a Domain's Worth of Malware - Jeff McJunkin

[Youtube Finding a Domain's Worth of Malware - Jeff McJunkin](https://youtu.be/DgxZ8ssuI_o):

https://www.wildwesthackinfest.com/

Are you tired of demonstrations of products that take months or years to get effective data from? How many products have you seen half-implemented (but fully paid for!) that didn’t ever deliver any real value to your organization? Here, I’ll discuss multiple free products that you can use next week to find evil inside your organization. Some techniques will find less advanced adversaries, and some will trip up even some of the most advanced ones - but they’ll all deliver value in less than a week of implementation, and I’ll discuss how you can integrate them and find the malware you already have in your environment. “Assume breach”...then find it!

Jeff McJunkin @jeffmcjunkin is Founder of Rogue Valley Information Security with more than nine years of experience in systems and network administration and network security. His greatest strength is his breadth of experience - from network and web application penetration testing to digital/mobile forensics, and from technical training to systems architecture. Jeff is a computer security/information assurance graduate of Southern Oregon University and holds many professional certifications. He has also competed in many security competitions, including taking first place at a regional NetWars competition and a U.S. Cyber Challenge capture-the-flag competition, as well as joining the Red Team for the Pacific Rim Collegiate Cyber Defence Competition. His personal blog can be found at http://jeffmcjunkin.com/.

## Introduction

Detection engineering is not just something to strive towards and build over months and years. There immediate off-the-shelf software and freely shared knowledge; Infosec freely shares - use it!

This is tactical not strategic - setting up for the long-term, going zero control to lots of controls.

Threat model properly:
- Persistent Malware not caught
- Advanced LOLBAS - [[Windows-Living-Off-The-Land]]
- Shadow IT

#### Hunting

- Find Anomalous Behaviour
- Attackers are playing minesweeper vs Blue team view of Mitre Attack TTPs (easily overwhelming)
- Use deceptive techniques like honeypotting - 

#### Google Rapid Response

Remote Live Forensics - 50%~ Mitre Framework coverage
- [[Osquery]] integration

You can't really hide executing in memory, less there is no hunt to network attacks 

[[Velociraptor]] alternative GRR

#### RITA - Blackhills

Aid, but not replace IR or Threat Hunters

Build a good white list you will find false positives

1. First Pass
	1. Image a new workstation
	2. Install [[Wireshark]]
	3. Log in and open all regular applications
	4. Record all traffic for >=24 hours
	5. Import in to [[Zeek]], analyse with RITA, whitelist everything that beacons
2. Second Pass
	1. Capture a weeks worth of traffic
	2. Analyze with [[Zeek]]
	3. Filter out beaconing traffic using SplitCap or for Linux
	4. Analyse beaconing traffic and attempt to rule out benign traffic
3. Third Pass
	1. Filter with RITA

Trace by application, very useful:
```powershell
netsh trace start capturetype=physical capture=yes maxSize=1024 overwrite=yes tracefile=C:\Windows\Temp\rite-NetTrace.etl filemode=single ipv4.address=$beaconingIpv4Addr
```

#### Finding unique SSL client with ja

ja/ja3s (server-side) is a way to categorise the plain text phases on SSL.

From ja3er.com - The JA3 algorithm takes a collection of settings from the SSL client hello such as SSL/TLS version, accepted cipher suites, list of extensions, accepted elliptic curves and elliptic curve formats.

New ja3s client certificate going out is a flexible signature to perform further investigation

Hitting attackers where it hurts by fingerprinting encrypted channels with [[Zeek]] 

1. Install secxurity onion
2. Point SPAN traffic at dedicated netwokr port
3. Send [[Zeek]] / [[Suricata]] logs to [[SIEM-Solutions]] of choice
4. Baseline in similar fashion to RITA
5. Enrich remaining ja3 data from https://ja3er.com/ for ja3 signatures

#### Point?

Use the free resources, [[Detection-Engineering]] is about sharing use it, help others and contribute - there are giants , help maintain and use them - forget analysis paralysis and scammy-blicky-box-expensive-all-in-one-in-a-boxes-solutions

## References

[Youtube Finding a Domain's Worth of Malware - Jeff McJunkin](https://youtu.be/DgxZ8ssuI_o)
[wildwesthackinfest](https://www.wildwesthackinfest.com/)
[jeffmcjunkin](http://jeffmcjunkin.com/.)
[ja3er - ja3 signatures](https://ja3er.com/)