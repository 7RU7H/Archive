# (Kali) Linux Networking
Depending on the Linux flavor the default naming of the interfaces may vary. For detail information about [[Linux-Network-Services]] follow the link.
Configuration in the GUI can be done: `Advanced Network Configuration`

Writing to `/etc/network/interfaces` will override default 

For Example:
allow-hotplug eth0		# specify interface, when kernel detects hot-plug event
iface eth0 inet static		# iface = interface, inet is the connection type made, static or dynamic
      address 10.10.10.10
      netmask 255.255.255.0	# netmask = network mask of the network the IP is on
      gateway 10.1.1.1		# IP the network need to reach out to reach other networks

Useful command, but full legacy included list can be found here: [[Linux-Networking-Commands]]
```
# Essentials
ifconfig 		# local ip, interfaces, netmask, MAC address, network metrics configuration
#  ifconfig is legacy tool use IP
ip addr/a 		# 
hostname

# Network activity

netstat
# netstat is legacy tool use ss
ss -natup
arp 
arp -en 					# -e default linux sytle output, -n numerical addresses

ping						# test connectivity (ICMP)
route						# display list of routes 
sudo ip route add <ip address/cdir>  dev <iface># add a route to address

traceroute					# (ICMP) detirmine how many hops between hosts' routers

wget						# download a webpage
curl						# very powerful, cli web interaction tool

dig						# perform DNS lookups
host						# get ip of domain
nslookup					# Legacy dig
```

Manual changing of IP can be done:
IPv4/IPv6 -> change Automatic to Manual 

TERMS		ALSOCALLED	DESCRIPTION

eth0		ethernet 	ethernet interface, a cable connection, numbered
lo		loopback
localhost			default ip address assign to this interface = 127.0.0.1
wlan0		wireless	wireless interface, a 	


inet IP/netmask in CIDR notation, CONNECTIONTYPE MAC address


## Checking Sockets

run ss -tulpn and it will report which sockets are running
Argument        Description
-t      Display TCP sockets
-u      Display UDP sockets
-l      Displays only listening sockets
-p      Shows the process using the socket
-n      Doesn't resolve service names



## Name Resolution and DNS:

Nameserver line is most important = DNS server USED FOR ANY AND ALL OUTSIDE DOMAIN REFERENCES

if /etc/resolv.conf fails then an second DNS set can attempt to resolve
if does not require a full DNS resolution /etc/hosts

After files mdns4\_minimal is searched before making a DNS query 

/etc/resolv.conf
```bash
domain ENTRY.com
SEARCH ENTRY.com
nameserver IP-OF-ENTRY.COM

# Top level domain(TLD) = com, .biz, .edu, .gov, .org, etc. 
# ENTRY + (TLD) = Root domain
# VOST.ENTRY
# If the domain entry is not in the configuration, the search entry will be used. 
# There can only be one value for the domain entry, whereas the search line can have a list of domains to auto-resolve.
# The domain entry will take priority
# If there was a need to auto-resolve to multiple domains, the search entry line should be used and the domain entry line removed.
# If configured:
domain ENTRY.com
SEARCH ENTRY.com
nameserver IP-OF-ENTRY.COM
nameserver ANOTHER-OF-ENTRY.COM
# nameserver line will be used for outside addressing
```

/etc/hosts
```bash
# When you don't need a full DNS server
IP	namesever
```

/etc/nsswitch.conf
```bash
# Order of name resolution is handled by the nsswitch.conf
COL:	SERVICE	SERVICE-HANDLING	
	name	localfile mdns4_minimal	dns

#IF mdns4_minimal is a multicast DNS resolver THEN auto-populate entries with a .local TLD
#IF NO SEARCH ending .local THEN normal DNS search
#Service should be referenced to /etc/hosts if local!
```

# ACL & UFW & iptables & FWBuilder

iptables tables:
POLICIES: ACCEPT, DROP, REJECT

filter: is the default table contains built-in chains:
	INPUT (for packets destined to local sockets)
	FORWARD (for packets being routed through the box)
	OUTPUT (for locally-generated packets)
nat: a table consulted for when a packet creates a new connection; built-ins:
	PREROUTING (for altering packets as soon as they come in)
	INPUT (for altering packets destined for local sockets)
	OUTPUT (for altering locally-generated packets before routing)
	POSTROUTING (for altering packets as they are about to go out) 
mangle: specialized table for packet alteration; built-ins
	PREROUTING (for altering incoming packets before routing)
	OUTPUT (for altering locally-generated packets before routing) //Since kernel 2.4.18, three other built-in chains are also supported: 
	INPUT (for packets coming into the box itself)
	FORWARD (for altering packets being routed through the box)
	POSTROUTING (for altering packets as they are about to go out)
raw: mostly for configuraing exemptions from connection tracking in combination with the NOTRACK target; registers at the netfilter with high priority, thus called before ip_contrack or ANY other IP table built-ins: 
	PREROUTING (for packets arriving via any network interface) 
	OUTPUT (for packets generated by local processes)
security: table for MAC networking rules, enable SECMARK and CONNECMARK targets, the security table is called after the filter table, allowing any Discretionary Access Control (DAC) rules in the filter table to take effect before MAC rules. Built-in chains: 
	INPUT (for packets coming into the box itself)
	OUTPUT (for altering locally-generated packets before routing)
	FORWARD (for altering packets being routed through the box)

```bash
iptables --help
	-L			list
	-P chain policy         edit chain policy defaults	
	-p tcp,udp,icmp 	display protocols 
	-s 			defines source address in connection
	-d			defines destination address in connection
	-i			defines inbound interfaces
	-o			defines outbound interfaces
	-A			append rule to the chain 
	-C			check rule is in chain
	-D			delete rule from a chain
	-I			insert rule into a chain 
	-R			replace rule in  a chain
	-m modulename		use module	
	
	-j DROP/ACCEPT/REJECT	target assignment(combine with -R to replace the assign policy target				
	--dport	portnumber	specify a destination port(combine with -R to only route traffic from an ip through a port)
	--sport	portnumber	specify a source port
	-v			amount of packets and bytes
	-n			only display ip addresses
	--line-numbers		useful for specifications i.e -L --line-numbers

# examples
sudo iptables -s $IP/$CIDR -p all -A INPUT -j ACCEPT # Append a Accept ruel all protocol transmission from IP/CIDR
sudo iptables -s 127.0.0.1 -d $DSTIP -p tcp -A INPUT # source and destination using tcp 
sudo iptables -D INPUT 	# delete rule on line 5
sudo iptables -nvL # list display ips and packet amounts
sudo iptables -R INPUT 2 -s 192.168.1.0/24 -p tcp -dport 8080 -j DROP # REPLACE input line 2 to drop tcp connection from source IP 
iptables-save # to save iptables 
```
#### Stateful firewalls conntrack

conntrack module, a subset of --ctstate of the iptable-exetensions package
Note that on older Linux kernels, this would show as --state instead of --ctstate.
can be used to to create rules based on the type of connection made
```bawsh
-m conntrack
```

INVALID: The packet is associated with no known connection.
NEW: The packet has started a new connection or otherwise associated with a connection that has not seen packets in both directions.
ESTABLISHED: The packet is associated with a connection that has seen packets in both directions.
RELATED: The packet is starting a new connection, but is associated with an existing connection, such as an FTP data transfer or an ICMP error.
UNTRACKED: The packet is not tracked at all, which happens if you explicitly untrack it by using -j CT --notrack in the raw table.



## SSH SCP SSHPASS

```bash
sudo systemctl start ssh
sudo systemctl status ssh
sudo systemctl stop ssh

ssh
-i id_rsa
-p $PORT
o stricthostkeychecking=no # useful for labs NOT FOR GENERAL USE!
```

ssh configuration occurs in `/etc/ssh/ssh_config/`

Known hosts per user `/home/user/.ssh/known_hosts` 

SSHPASS utilty supplies the ssh password in the command execution; it has security flaws:
1. Command history
1. Password is in plaintext

